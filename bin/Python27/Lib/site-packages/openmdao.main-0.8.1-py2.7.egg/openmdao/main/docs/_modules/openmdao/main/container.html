
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>openmdao.main.container &mdash; OpenMDAO Documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.8.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="OpenMDAO Documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../../../index.html">OpenMDAO Documentation v0.8.1</a> &raquo;</li>

          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for openmdao.main.container</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The Container class.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">import</span> <span class="nn">weakref</span>
<span class="c"># the following is a monkey-patch to correct a problem with</span>
<span class="c"># copying/deepcopying weakrefs There is an issue in the python issue tracker</span>
<span class="c"># regarding this, but it isn&#39;t fixed yet.</span>

<span class="c"># pylint: disable-msg=W0212</span>
<span class="n">copy</span><span class="o">.</span><span class="n">_copy_dispatch</span><span class="p">[</span><span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">_copy_immutable</span>
<span class="n">copy</span><span class="o">.</span><span class="n">_deepcopy_dispatch</span><span class="p">[</span><span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">_deepcopy_atomic</span>
<span class="n">copy</span><span class="o">.</span><span class="n">_deepcopy_dispatch</span><span class="p">[</span><span class="n">weakref</span><span class="o">.</span><span class="n">KeyedRef</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">_deepcopy_atomic</span>
<span class="c"># pylint: enable-msg=W0212</span>

<span class="c"># pylint apparently doesn&#39;t understand namespace packages...</span>
<span class="c"># pylint: disable-msg=E0611,F0401</span>

<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">Interface</span><span class="p">,</span> <span class="n">implements</span>

<span class="kn">from</span> <span class="nn">traits.api</span> <span class="kn">import</span> <span class="n">HasTraits</span><span class="p">,</span> <span class="n">Missing</span><span class="p">,</span> <span class="n">Python</span><span class="p">,</span> \
                       <span class="n">push_exception_handler</span><span class="p">,</span> <span class="n">TraitType</span><span class="p">,</span> <span class="n">CTrait</span>
<span class="kn">from</span> <span class="nn">traits.trait_handlers</span> <span class="kn">import</span> <span class="n">TraitListObject</span>
<span class="kn">from</span> <span class="nn">traits.has_traits</span> <span class="kn">import</span> <span class="n">FunctionType</span><span class="p">,</span> <span class="n">_clone_trait</span><span class="p">,</span> <span class="n">MetaHasTraits</span>
<span class="kn">from</span> <span class="nn">traits.trait_base</span> <span class="kn">import</span> <span class="n">not_none</span>

<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">connection</span>

<span class="kn">from</span> <span class="nn">openmdao.main.attrwrapper</span> <span class="kn">import</span> <span class="n">AttrWrapper</span>
<span class="kn">from</span> <span class="nn">openmdao.main.datatypes.file</span> <span class="kn">import</span> <span class="n">FileRef</span>
<span class="kn">from</span> <span class="nn">openmdao.main.datatypes.list</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">openmdao.main.datatypes.slot</span> <span class="kn">import</span> <span class="n">Slot</span>
<span class="kn">from</span> <span class="nn">openmdao.main.datatypes.vtree</span> <span class="kn">import</span> <span class="n">VarTree</span>
<span class="kn">from</span> <span class="nn">openmdao.main.expreval</span> <span class="kn">import</span> <span class="n">ExprEvaluator</span><span class="p">,</span> <span class="n">ConnectedExprEvaluator</span>
<span class="kn">from</span> <span class="nn">openmdao.main.interfaces</span> <span class="kn">import</span> <span class="n">ICaseIterator</span><span class="p">,</span> <span class="n">IResourceAllocator</span><span class="p">,</span> \
                                     <span class="n">IContainer</span><span class="p">,</span> <span class="n">IParametricGeometry</span>
<span class="kn">from</span> <span class="nn">openmdao.main.index</span> <span class="kn">import</span> <span class="n">process_index_entry</span><span class="p">,</span> <span class="n">get_indexed_value</span><span class="p">,</span> \
                                <span class="n">INDEX</span><span class="p">,</span> <span class="n">ATTR</span><span class="p">,</span> <span class="n">SLICE</span>
<span class="kn">from</span> <span class="nn">openmdao.main.mp_support</span> <span class="kn">import</span> <span class="n">ObjectManager</span><span class="p">,</span> <span class="n">OpenMDAO_Proxy</span><span class="p">,</span> \
                                     <span class="n">is_instance</span><span class="p">,</span> <span class="n">CLASSES_TO_PROXY</span>
<span class="kn">from</span> <span class="nn">openmdao.main.rbac</span> <span class="kn">import</span> <span class="n">rbac</span>
<span class="kn">from</span> <span class="nn">openmdao.main.variable</span> <span class="kn">import</span> <span class="n">Variable</span><span class="p">,</span> <span class="n">is_legal_name</span>
<span class="kn">from</span> <span class="nn">openmdao.util.log</span> <span class="kn">import</span> <span class="n">Logger</span><span class="p">,</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">openmdao.util</span> <span class="kn">import</span> <span class="n">eggloader</span><span class="p">,</span> <span class="n">eggsaver</span><span class="p">,</span> <span class="n">eggobserver</span>
<span class="kn">from</span> <span class="nn">openmdao.util.eggsaver</span> <span class="kn">import</span> <span class="n">SAVE_CPICKLE</span>

<span class="n">_copydict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;deep&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">,</span>
    <span class="s">&#39;shallow&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span>
<span class="p">}</span>

<span class="n">_iodict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;out&#39;</span><span class="p">:</span> <span class="s">&#39;output&#39;</span><span class="p">,</span> <span class="s">&#39;in&#39;</span><span class="p">:</span> <span class="s">&#39;input&#39;</span><span class="p">}</span>

<span class="n">_missing</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>


<div class="viewcode-block" id="get_closest_proxy"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.get_closest_proxy">[docs]</a><span class="k">def</span> <span class="nf">get_closest_proxy</span><span class="p">(</span><span class="n">start_scope</span><span class="p">,</span> <span class="n">pathname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Resolve down to the closest in-process parent object</span>
<span class="sd">    of the object indicated by pathname.</span>
<span class="sd">    Returns a tuple containing (proxy_or_parent, rest_of_pathname)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">start_scope</span>
    <span class="n">names</span> <span class="o">=</span> <span class="n">pathname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Container</span><span class="p">):</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">:]))</span>

</div>
<div class="viewcode-block" id="build_container_hierarchy"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.build_container_hierarchy">[docs]</a><span class="k">def</span> <span class="nf">build_container_hierarchy</span><span class="p">(</span><span class="n">dct</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a hierarchy of Containers based on the contents of a nested dict.</span>
<span class="sd">    There will always be a single top level scoping Container regardless of the</span>
<span class="sd">    contents of dct.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">top</span> <span class="o">=</span> <span class="n">Container</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dct</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>  <span class="c"># it&#39;s a dict, so this is a Container</span>
            <span class="n">top</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">build_container_hierarchy</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">top</span>


<span class="c"># this causes any exceptions occurring in trait handlers to be re-raised.</span>
<span class="c"># Without this, the default behavior is for the exception to be logged and not</span>
<span class="c"># re-raised.</span></div>
<span class="n">push_exception_handler</span><span class="p">(</span><span class="n">handler</span><span class="o">=</span><span class="k">lambda</span> <span class="n">o</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">ov</span><span class="p">,</span> <span class="n">nv</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                       <span class="n">reraise_exceptions</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                       <span class="n">main</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                       <span class="n">locked</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_ContainerDepends</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An object that bookkeeps connections to/from Container variables.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_srcs</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">check_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">srcpath</span><span class="p">,</span> <span class="n">destpath</span><span class="p">):</span>
        <span class="n">dpdot</span> <span class="o">=</span> <span class="n">destpath</span><span class="o">+</span><span class="s">&#39;.&#39;</span>
        <span class="k">for</span> <span class="n">dst</span><span class="p">,</span> <span class="n">src</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_srcs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">destpath</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">dst</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">dst</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">dpdot</span><span class="p">)</span> <span class="ow">or</span> <span class="n">dst</span> <span class="o">==</span> <span class="n">destpath</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39; is already connected to source &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span>
                                   <span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">src</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">srcpath</span><span class="p">,</span> <span class="n">destpath</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_srcs</span><span class="p">[</span><span class="n">destpath</span><span class="p">]</span> <span class="o">=</span> <span class="n">srcpath</span>

    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">srcpath</span><span class="p">,</span> <span class="n">destpath</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_srcs</span><span class="p">[</span><span class="n">destpath</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">dpdot</span> <span class="o">=</span> <span class="n">destpath</span><span class="o">+</span><span class="s">&#39;.&#39;</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_srcs</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">dpdot</span><span class="p">)]:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_srcs</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;For a given destination name, return the connected source,</span>
<span class="sd">        or None if not connected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_srcs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">destname</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_MetaSafe</span><span class="p">(</span><span class="n">MetaHasTraits</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Tries to keep users from shooting themselves in the foot. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">class_dict</span><span class="p">):</span>
        <span class="c"># Check for overwrite of something that shouldn&#39;t be.</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">class_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Variable</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">base</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> overrides attribute </span><span class="si">%r</span><span class="s"> of </span><span class="si">%s</span><span class="s">&#39;</span>
                                        <span class="o">%</span> <span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">__name__</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">_MetaSafe</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">class_dict</span><span class="p">)</span>


<div class="viewcode-block" id="SafeHasTraits"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.SafeHasTraits">[docs]</a><span class="k">class</span> <span class="nc">SafeHasTraits</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Special :class:`HasTraits` which is configured such that the class is</span>
<span class="sd">    checked for any :class:`Variable` which might override an existing</span>
<span class="sd">    attribute in any base class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Doing this in Container breaks implements(IContainer) such that</span>
    <span class="c"># implementedBy() would return False.</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">_MetaSafe</span>

</div>
<div class="viewcode-block" id="Container"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container">[docs]</a><span class="k">class</span> <span class="nc">Container</span><span class="p">(</span><span class="n">SafeHasTraits</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Base class for all objects having Traits that are visible</span>
<span class="sd">    to the framework&quot;&quot;&quot;</span>

    <span class="n">implements</span><span class="p">(</span><span class="n">IContainer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Container</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_call_cpath_updated</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_call_configure</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_managers</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c"># Object manager for remote access by authkey.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_depgraph</span> <span class="o">=</span> <span class="n">_ContainerDepends</span><span class="p">()</span>

        <span class="c"># for keeping track of dynamically added traits for serialization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_added_traits</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cached_traits_</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># TODO: see about turning this back into a regular logger and just</span>
        <span class="c"># handling its unpickleability in __getstate__/__setstate__ in</span>
        <span class="c"># order to avoid the extra layer of function calls when logging</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="c"># Create per-instance initial FileRefs for File traits. There ought</span>
        <span class="c"># to be a better way to not share default initial values, but</span>
        <span class="c"># FileRef.get_default_value/make_default won&#39;t pickle.</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">FileRef</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="p">))</span>

        <span class="c"># Similarly, create per-instance VariableTrees for VarTree traits.</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;__class_traits__&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ttype</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">trait_type</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ttype</span><span class="p">,</span> <span class="n">VarTree</span><span class="p">):</span>
                <span class="n">variable_tree</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="n">variable_tree</span><span class="o">.</span><span class="n">_parent</span>
                <span class="n">variable_tree</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">new_tree</span> <span class="o">=</span> <span class="n">variable_tree</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="n">variable_tree</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">parent</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">new_tree</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The parent Container of this Container.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span>

    <span class="nd">@parent.setter</span>
<div class="viewcode-block" id="Container.parent"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.parent">[docs]</a>    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This is called when the parent attribute is changed.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pathname</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;,&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_branch_moved</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">_branch_moved</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_call_cpath_updated</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">cont</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="n">Container</span><span class="p">):</span>
                <span class="n">cont</span><span class="o">.</span><span class="n">_branch_moved</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The name of this Container.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">find_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_cpath_updated</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="nd">@name.setter</span>
<div class="viewcode-block" id="Container.name"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.name">[docs]</a>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the name of this Container.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_legal_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&quot;name &#39;</span><span class="si">%s</span><span class="s">&#39; contains illegal characters&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">)</span>
</div>
    <span class="nd">@rbac</span><span class="p">((</span><span class="s">&#39;owner&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">))</span>
<div class="viewcode-block" id="Container.get_pathname"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.get_pathname">[docs]</a>    <span class="k">def</span> <span class="nf">get_pathname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel_to_scope</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return full path name to this container, relative to scope</span>
<span class="sd">        *rel_to_scope*. If *rel_to_scope* is *None*, return the full pathname.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span>
        <span class="k">while</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">rel_to_scope</span> <span class="ow">and</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</div>
    <span class="nd">@rbac</span><span class="p">((</span><span class="s">&#39;owner&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">))</span>
<div class="viewcode-block" id="Container.connect"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">srcexpr</span><span class="p">,</span> <span class="n">destexpr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Connects one source expression to one destination expression.</span>
<span class="sd">        When a name begins with &quot;parent.&quot;, that indicates</span>
<span class="sd">        it is referring to a variable outside of this object&#39;s scope.</span>

<span class="sd">        srcexpr: str or ExprEvaluator</span>
<span class="sd">            Source expression object or expression string.</span>

<span class="sd">        destexpr: str or ExprEvaluator</span>
<span class="sd">            Destination expression object or expression string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">child_connections</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c"># for undo</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">srcexpr</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">srcexpr</span> <span class="o">=</span> <span class="n">ConnectedExprEvaluator</span><span class="p">(</span><span class="n">srcexpr</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">destexpr</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">destexpr</span> <span class="o">=</span> <span class="n">ConnectedExprEvaluator</span><span class="p">(</span><span class="n">destexpr</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">is_dest</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">destpath</span> <span class="o">=</span> <span class="n">destexpr</span><span class="o">.</span><span class="n">text</span>
        <span class="n">srcpath</span> <span class="o">=</span> <span class="n">srcexpr</span><span class="o">.</span><span class="n">text</span>

        <span class="c"># check for self connections</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">destpath</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;parent.&#39;</span><span class="p">):</span>
            <span class="n">vpath</span> <span class="o">=</span> <span class="n">destpath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">cname2</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">destvar</span> <span class="o">=</span> <span class="n">vpath</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
            <span class="n">destvar</span> <span class="o">=</span> <span class="n">destpath</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">cname2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">cname2</span> <span class="ow">in</span> <span class="n">srcexpr</span><span class="o">.</span><span class="n">get_referenced_compnames</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;Cannot connect &#39;</span><span class="si">%s</span><span class="s">&#39; to &#39;</span><span class="si">%s</span><span class="s">&#39;. Both refer&quot;</span>
                                     <span class="s">&quot; to the same component.&quot;</span> <span class="o">%</span>
                                     <span class="p">(</span><span class="n">srcpath</span><span class="p">,</span> <span class="n">destpath</span><span class="p">),</span> <span class="ne">RuntimeError</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_depgraph</span><span class="o">.</span><span class="n">check_connect</span><span class="p">(</span><span class="n">srcpath</span><span class="p">,</span> <span class="n">destpath</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">destpath</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;parent.&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">destpath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;Can&#39;t find &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">destpath</span><span class="p">,</span>
                                         <span class="ne">AttributeError</span><span class="p">)</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="n">destpath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)):</span>
                    <span class="n">dname</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">sname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_depgraph</span><span class="o">.</span><span class="n">get_source</span><span class="p">(</span><span class="n">dname</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">sname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span>
                            <span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39; is already connected to source &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span>
                            <span class="p">(</span><span class="n">dname</span><span class="p">,</span> <span class="n">sname</span><span class="p">),</span> <span class="ne">RuntimeError</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">destvar</span><span class="p">:</span>
                    <span class="n">child</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cname2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">Container</span><span class="p">):</span>
                        <span class="n">childsrc</span> <span class="o">=</span> <span class="n">srcexpr</span><span class="o">.</span><span class="n">scope_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">childsrc</span><span class="p">,</span> <span class="n">destvar</span><span class="p">)</span>
                        <span class="n">child_connections</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">child</span><span class="p">,</span> <span class="n">childsrc</span><span class="p">,</span> <span class="n">destvar</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">srcvar</span> <span class="ow">in</span> <span class="n">srcexpr</span><span class="o">.</span><span class="n">get_referenced_varpaths</span><span class="p">(</span><span class="n">copy</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">srcvar</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;parent.&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">srcvar</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;Can&#39;t find &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">srcvar</span><span class="p">,</span>
                                             <span class="ne">AttributeError</span><span class="p">)</span>

            <span class="n">srccomps</span> <span class="o">=</span> <span class="n">srcexpr</span><span class="o">.</span><span class="n">get_referenced_compnames</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">srccomps</span><span class="p">:</span>
                <span class="n">cname</span> <span class="o">=</span> <span class="n">srccomps</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">cname</span> <span class="o">!=</span> <span class="s">&#39;parent&#39;</span><span class="p">:</span>
                    <span class="n">child</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">Container</span><span class="p">):</span>
                        <span class="n">childdest</span> <span class="o">=</span> <span class="s">&#39;parent.&#39;</span><span class="o">+</span><span class="n">destpath</span>
                        <span class="n">restofpath</span> <span class="o">=</span> <span class="n">srcexpr</span><span class="o">.</span><span class="n">scope_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">restofpath</span><span class="p">,</span> <span class="n">childdest</span><span class="p">)</span>
                        <span class="n">child_connections</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">child</span><span class="p">,</span> <span class="n">restofpath</span><span class="p">,</span> <span class="n">childdest</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_depgraph</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">srcpath</span><span class="p">,</span> <span class="n">destpath</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">child</span><span class="p">,</span> <span class="n">childsrc</span><span class="p">,</span> <span class="n">childdest</span> <span class="ow">in</span> <span class="n">child_connections</span><span class="p">:</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">childsrc</span><span class="p">,</span> <span class="n">childdest</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;Can&#39;t connect &#39;</span><span class="si">%s</span><span class="s">&#39; to &#39;</span><span class="si">%s</span><span class="s">&#39;: </span><span class="si">%s</span><span class="s">&quot;</span>
                                 <span class="o">%</span> <span class="p">(</span><span class="n">srcpath</span><span class="p">,</span> <span class="n">destpath</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)),</span> <span class="ne">RuntimeError</span><span class="p">)</span>
</div>
    <span class="nd">@rbac</span><span class="p">((</span><span class="s">&#39;owner&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">))</span>
<div class="viewcode-block" id="Container.disconnect"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.disconnect">[docs]</a>    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">srcpath</span><span class="p">,</span> <span class="n">destpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes the connection between one source variable and one</span>
<span class="sd">        destination variable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cname</span> <span class="o">=</span> <span class="n">cname2</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">destvar</span> <span class="o">=</span> <span class="n">destpath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">srcexpr</span> <span class="o">=</span> <span class="n">ExprEvaluator</span><span class="p">(</span><span class="n">srcpath</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">srcexpr</span><span class="o">.</span><span class="n">refs_parent</span><span class="p">():</span>
            <span class="n">srcvar</span> <span class="o">=</span> <span class="n">srcexpr</span><span class="o">.</span><span class="n">get_referenced_varpaths</span><span class="p">()</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">srcvar</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;Can&#39;t find &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">srcvar</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">)</span>
            <span class="n">srccomps</span> <span class="o">=</span> <span class="n">srcexpr</span><span class="o">.</span><span class="n">get_referenced_compnames</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">srccomps</span><span class="p">:</span>
                <span class="n">cname</span> <span class="o">=</span> <span class="n">srccomps</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">cname</span> <span class="o">!=</span> <span class="s">&#39;parent&#39;</span><span class="p">:</span>
                    <span class="n">child</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">Container</span><span class="p">):</span>
                        <span class="n">childdest</span> <span class="o">=</span> <span class="s">&#39;parent.&#39;</span><span class="o">+</span><span class="n">destpath</span>
                        <span class="n">restofpath</span> <span class="o">=</span> <span class="n">srcexpr</span><span class="o">.</span><span class="n">scope_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">restofpath</span><span class="p">,</span> <span class="n">childdest</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">destpath</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;parent.&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">destvar</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;Can&#39;t find &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">destvar</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">)</span>
            <span class="n">cname2</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">restofpath</span> <span class="o">=</span> <span class="n">destpath</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">restofpath</span><span class="p">:</span>
                <span class="n">child</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cname2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">Container</span><span class="p">):</span>
                    <span class="n">childsrc</span> <span class="o">=</span> <span class="n">srcexpr</span><span class="o">.</span><span class="n">scope_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">childsrc</span><span class="p">,</span> <span class="n">restofpath</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cname</span> <span class="o">==</span> <span class="n">cname2</span> <span class="ow">and</span> <span class="n">cname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;Can&#39;t disconnect &#39;</span><span class="si">%s</span><span class="s">&#39; from &#39;</span><span class="si">%s</span><span class="s">&#39;. &quot;</span>
                                 <span class="s">&quot;Both variables are on the same component&quot;</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="n">srcpath</span><span class="p">,</span> <span class="n">destpath</span><span class="p">),</span> <span class="ne">RuntimeError</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_depgraph</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">srcpath</span><span class="p">,</span> <span class="n">destpath</span><span class="p">)</span>

    <span class="c">#TODO: get rid of any notion of valid/invalid from Containers.  If they have</span>
    <span class="c"># no execute, they can have no inputs/outputs, which means that validity should have</span>
    <span class="c"># no meaning for them.</span></div>
<div class="viewcode-block" id="Container.is_valid"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.is_valid">[docs]</a>    <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="Container.get_trait"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.get_trait">[docs]</a>    <span class="k">def</span> <span class="nf">get_trait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the trait indicated by name, or None if not found.  No recursive</span>
<span class="sd">        search is performed if name contains dots.  This is a replacement</span>
<span class="sd">        for the trait() method on HasTraits objects because that method</span>
<span class="sd">        can return traits that shouldn&#39;t exist. DO NOT use the trait() function</span>
<span class="sd">        as a way to determine the existence of a trait.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_traits_</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cached_traits_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">traits</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cached_traits_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_instance_traits</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_traits_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="n">copy</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_traits_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="c">#</span>
    <span class="c">#  HasTraits overrides</span>
    <span class="c">#</span>
</div>
    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Overrides deepcopy for HasTraits because otherwise we lose instance</span>
<span class="sd">        traits when we copy. :(</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">id_self</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">id_self</span> <span class="ow">in</span> <span class="n">memo</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">memo</span><span class="p">[</span><span class="n">id_self</span><span class="p">]</span>

        <span class="c"># Make sure HasTraits is performing all deepcopies. We need this</span>
        <span class="c"># in order for our sub-components and objects to get deep-copied.</span>
        <span class="n">memo</span><span class="p">[</span><span class="s">&#39;traits_copy_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;deep&quot;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Container</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__deepcopy__</span><span class="p">(</span><span class="n">memo</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_cached_traits_</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># Instance traits are not created properly by deepcopy, so we need</span>
        <span class="c"># to manually recreate them. Note, self._added_traits is the most</span>
        <span class="c"># accurate listing of them. Self._instance_traits includes some</span>
        <span class="c"># extra stuff.</span>
        <span class="n">olditraits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instance_traits</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">trait</span> <span class="ow">in</span> <span class="n">olditraits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">trait</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s">&#39;event&#39;</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_added_traits</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trait</span><span class="o">.</span><span class="n">trait_type</span><span class="p">,</span> <span class="n">VarTree</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">_added_traits</span><span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">_clone_trait</span><span class="p">(</span><span class="n">trait</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">_clone_trait</span><span class="p">(</span><span class="n">trait</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>  <span class="c"># Not true with VarTree</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return dict representing this container&#39;s state.&quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Container</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__getstate__</span><span class="p">()</span>
        <span class="n">dct</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">list_fixups</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">trait</span> <span class="ow">in</span> <span class="n">state</span><span class="p">[</span><span class="s">&#39;_added_traits&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">trait</span><span class="o">.</span><span class="n">transient</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">dct</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">trait</span>
                <span class="c"># List trait values lose their &#39;name&#39; for some reason.</span>
                <span class="c"># Remember the values here so we don&#39;t need to getattr()</span>
                <span class="c"># during __setstate__().</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trait</span><span class="p">,</span> <span class="n">List</span><span class="p">):</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">TraitListObject</span><span class="p">):</span>
                        <span class="n">list_fixups</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="n">state</span><span class="p">[</span><span class="s">&#39;_added_traits&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dct</span>
        <span class="n">state</span><span class="p">[</span><span class="s">&#39;_cached_traits_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">state</span><span class="p">[</span><span class="s">&#39;_list_fixups&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">list_fixups</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Restore this component&#39;s state.&quot;&quot;&quot;</span>
        <span class="n">list_fixups</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;_list_fixups&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Container</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__setstate__</span><span class="p">({})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

        <span class="c"># restore dynamically added traits, since they don&#39;t seem</span>
        <span class="c"># to get restored automatically</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cached_traits_</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">traits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alltraits</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">trait</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_added_traits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">traits</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">trait</span><span class="p">)</span>

        <span class="c"># List trait values lose their &#39;name&#39; for some reason.</span>
        <span class="c"># Restore from remembered values.</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">list_fixups</span><span class="p">:</span>
            <span class="n">list_fixups</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

        <span class="c"># Fix property traits that were not just added above.</span>
        <span class="c"># For some reason they lost &#39;get()&#39;, but not &#39;set()&#39; capability.</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">trait</span> <span class="ow">in</span> <span class="n">traits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">get</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">trait_type</span><span class="o">.</span><span class="n">get</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">get</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_added_traits</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remove_trait</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">trait</span><span class="p">)</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="c"># after unpickling, implicitly defined traits disappear, so we have to</span>
        <span class="c"># recreate them by assigning them to themselves.</span>
        <span class="c">#TODO: I&#39;m probably missing something. There has to be a better way to</span>
        <span class="c">#      do this...</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trait</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>  <span class="c"># force def of implicit trait</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cached_traits_</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Container.add_class_trait"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.add_class_trait">[docs]</a>    <span class="k">def</span> <span class="nf">add_class_trait</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">trait</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Overrides HasTraits definition of *add_class_trait* to</span>
<span class="sd">        try to keep from clobbering framework stuff.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bases</span> <span class="o">=</span> <span class="p">[</span><span class="n">cls</span><span class="p">]</span>
        <span class="n">bases</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">__bases__</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">base</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;Would override attribute </span><span class="si">%r</span><span class="s"> of </span><span class="si">%s</span><span class="s">&#39;</span>
                                <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">__name__</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Container</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">add_class_trait</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">trait</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Container.add_trait"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.add_trait">[docs]</a>    <span class="k">def</span> <span class="nf">add_trait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">trait</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Overrides HasTraits definition of *add_trait* in order to</span>
<span class="sd">        keep track of dynamically added traits for serialization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># When a trait with sub-traits is added (like a List or Dict),</span>
        <span class="c"># HasTraits calls add_trait AGAIN for the sub-trait, so we</span>
        <span class="c"># just detect it here and pass it through</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;_items&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">trait</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s">&#39;event&#39;</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Container</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">trait</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c"># Try to keep from clobbering framework stuff.</span>
        <span class="n">bases</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">]</span>
        <span class="n">bases</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__bases__</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">base</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;Would override attribute </span><span class="si">%r</span><span class="s"> of </span><span class="si">%s</span><span class="s">&#39;</span>
                                <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">__name__</span><span class="p">))</span>

        <span class="c">#FIXME: saving our own list of added traits shouldn&#39;t be necessary...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_added_traits</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">trait</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Container</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">trait</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_traits_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cached_traits_</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Container.remove_trait"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.remove_trait">[docs]</a>    <span class="k">def</span> <span class="nf">remove_trait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Overrides HasTraits definition of remove_trait in order to</span>
<span class="sd">        keep track of dynamically added traits for serialization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_added_traits</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_traits_</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Container</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">remove_trait</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</div>
    <span class="nd">@rbac</span><span class="p">((</span><span class="s">&#39;owner&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">))</span>
<div class="viewcode-block" id="Container.get_wrapped_attr"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.get_wrapped_attr">[docs]</a>    <span class="k">def</span> <span class="nf">get_wrapped_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;If the variable can return an AttrWrapper, then this</span>
<span class="sd">        function will return that, with the value set to the current value of</span>
<span class="sd">        the variable. Otherwise, it functions like *getattr*, just</span>
<span class="sd">        returning the value of the variable. Raises an exception if the</span>
<span class="sd">        variable cannot be found. The value will be copied if the variable has</span>
<span class="sd">        a &#39;copy&#39; metadata attribute that is not None. Possible values for</span>
<span class="sd">        &#39;copy&#39; are &#39;shallow&#39; and &#39;deep&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scopename</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">restofpath</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">restofpath</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scopename</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Container</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_wrapped_attr</span><span class="p">(</span><span class="n">restofpath</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">get_indexed_value</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">restofpath</span><span class="p">)</span>

        <span class="n">trait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trait</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trait</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;trait &#39;</span><span class="si">%s</span><span class="s">&#39; does not exist&quot;</span> <span class="o">%</span>
                                 <span class="n">name</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">)</span>

        <span class="c"># trait itself is most likely a CTrait, which doesn&#39;t have</span>
        <span class="c"># access to member functions on the original trait, aside</span>
        <span class="c"># from validate and one or two others, so we need to get access</span>
        <span class="c"># to the original trait which is held in the &#39;trait_type&#39; attribute.</span>
        <span class="n">ttype</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">trait_type</span>
        <span class="n">getwrapper</span> <span class="o">=</span> <span class="n">ttype</span><span class="o">.</span><span class="n">get_val_wrapper</span>

        <span class="c"># if we have an index, try to figure out if we can still use the trait</span>
        <span class="c"># metadata or not.  For example, if we have an Array that has units,</span>
        <span class="c"># it&#39;s also valid to return the units metadata if we&#39;re indexing into</span>
        <span class="c"># the Array, assuming that all entries in the Array have the same units.</span>

        <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># copy value if &#39;copy&#39; found in metadata</span>
            <span class="k">if</span> <span class="n">ttype</span><span class="o">.</span><span class="n">copy</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Container</span><span class="p">):</span>
                    <span class="n">old_parent</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">parent</span>
                    <span class="n">val</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">val_copy</span> <span class="o">=</span> <span class="n">_copydict</span><span class="p">[</span><span class="n">ttype</span><span class="o">.</span><span class="n">copy</span><span class="p">](</span><span class="n">val</span><span class="p">)</span>
                    <span class="k">finally</span><span class="p">:</span>
                        <span class="n">val</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">old_parent</span>
                    <span class="n">val_copy</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">val_copy</span><span class="p">,</span> <span class="s">&#39;install_callbacks&#39;</span><span class="p">):</span>
                        <span class="n">val_copy</span><span class="o">.</span><span class="n">install_callbacks</span><span class="p">()</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">val_copy</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">_copydict</span><span class="p">[</span><span class="n">ttype</span><span class="o">.</span><span class="n">copy</span><span class="p">](</span><span class="n">val</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">getwrapper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">getwrapper</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">get_indexed_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val</span>
</div>
<div class="viewcode-block" id="Container.add"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add an object to this Container.</span>
<span class="sd">        Returns the added object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span>
                <span class="s">&#39;add does not allow dotted path names like </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                <span class="n">name</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">is_legal_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39; is a reserved or invalid name&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span>
                                 <span class="ne">NameError</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Container</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_recursion</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">OpenMDAO_Proxy</span><span class="p">):</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_proxy</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="c"># if an old child with that name exists, remove it</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_traits_</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_trait</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cached_traits_</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="c"># if this object is already installed in a hierarchy, then go</span>
            <span class="c"># ahead and tell the obj (which will in turn tell all of its</span>
            <span class="c"># children) that its scope tree back to the root is defined.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_cpath_updated</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">cpath_updated</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">TraitType</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>
</div>
    <span class="k">def</span> <span class="nf">_check_recursion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check if adding `obj` will cause container recursion. &quot;&quot;&quot;</span>
        <span class="n">ancestor</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">while</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">ancestor</span><span class="p">,</span> <span class="n">Container</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="n">ancestor</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&#39;add would cause container recursion&#39;</span><span class="p">,</span>
                                     <span class="ne">ValueError</span><span class="p">)</span>
            <span class="n">ancestor</span> <span class="o">=</span> <span class="n">ancestor</span><span class="o">.</span><span class="n">parent</span>

    <span class="k">def</span> <span class="nf">_get_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return :class:`OpenMDAO_Proxy` for self usable by `proxy`.</span>
<span class="sd">        We create a manager for each access type.</span>
<span class="sd">        In addition, to avoid having to (remotely) manipulate a server&#39;s</span>
<span class="sd">        `allowed_hosts`, we use a separate manager for each client accessing</span>
<span class="sd">        via AF_INET from a unique host.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">addr_type</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">address_type</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">_token</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">_token</span><span class="o">.</span><span class="n">address</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">addr_type</span> <span class="o">==</span> <span class="s">&#39;AF_INET&#39;</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr_type</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">proxy</span><span class="o">.</span><span class="n">_authkey</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_managers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">addr_type</span> <span class="o">==</span> <span class="s">&#39;AF_INET&#39;</span><span class="p">:</span>
                <span class="n">ip_addr</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">())</span>
                <span class="n">address</span> <span class="o">=</span> <span class="p">(</span><span class="n">ip_addr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">allowed_hosts</span> <span class="o">=</span> <span class="p">[</span><span class="n">addr</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">addr</span> <span class="o">==</span> <span class="n">ip_addr</span><span class="p">:</span>
                    <span class="n">allowed_hosts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;127.0.0.1&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">address</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">allowed_hosts</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s">&#39;parent&#39;</span>
            <span class="n">access</span> <span class="o">=</span> <span class="n">addr</span> <span class="k">if</span> <span class="n">addr_type</span> <span class="o">==</span> <span class="s">&#39;AF_INET&#39;</span> <span class="k">else</span> <span class="n">addr_type</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">-cb-</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">access</span><span class="p">)</span>
            <span class="n">manager</span> <span class="o">=</span> <span class="n">ObjectManager</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">authkey</span><span class="o">=</span><span class="n">proxy</span><span class="o">.</span><span class="n">_authkey</span><span class="p">,</span>
                                    <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">allowed_hosts</span><span class="o">=</span><span class="n">allowed_hosts</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_managers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">manager</span>
        <span class="k">return</span> <span class="n">manager</span><span class="o">.</span><span class="n">proxy</span>

    <span class="k">def</span> <span class="nf">_check_rename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldname</span><span class="p">,</span> <span class="n">newname</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">oldname</span> <span class="ow">or</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">newname</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;can&#39;t rename &#39;</span><span class="si">%s</span><span class="s">&#39; to &#39;</span><span class="si">%s</span><span class="s">&#39;: rename only works&quot;</span>
                                 <span class="s">&quot; within a single scope.&quot;</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="n">oldname</span><span class="p">,</span> <span class="n">newname</span><span class="p">),</span> <span class="ne">RuntimeError</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">oldname</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;can&#39;t rename &#39;</span><span class="si">%s</span><span class="s">&#39; to &#39;</span><span class="si">%s</span><span class="s">&#39;: &#39;</span><span class="si">%s</span><span class="s">&#39; was not found.&quot;</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="n">oldname</span><span class="p">,</span> <span class="n">newname</span><span class="p">,</span> <span class="n">oldname</span><span class="p">),</span> <span class="ne">RuntimeError</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">newname</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;can&#39;t rename &#39;</span><span class="si">%s</span><span class="s">&#39; to &#39;</span><span class="si">%s</span><span class="s">&#39;: &#39;</span><span class="si">%s</span><span class="s">&#39; already exists.&quot;</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="n">oldname</span><span class="p">,</span> <span class="n">newname</span><span class="p">,</span> <span class="n">newname</span><span class="p">),</span> <span class="ne">RuntimeError</span><span class="p">)</span>

<div class="viewcode-block" id="Container.rename"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.rename">[docs]</a>    <span class="k">def</span> <span class="nf">rename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldname</span><span class="p">,</span> <span class="n">newname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Renames a child of this object from oldname to newname.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_rename</span><span class="p">(</span><span class="n">oldname</span><span class="p">,</span> <span class="n">newname</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">oldname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">newname</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Container.remove"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove the specified child from this container and remove any</span>
<span class="sd">        public trait objects that reference that child. Notify any</span>
<span class="sd">        observers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span>
                <span class="s">&#39;remove does not allow dotted path names like </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                                 <span class="n">name</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">)</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trait</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trait</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="c"># for Slot traits, set their value to None but don&#39;t remove</span>
            <span class="c"># the trait</span>
            <span class="k">if</span> <span class="n">trait</span><span class="o">.</span><span class="n">is_trait_type</span><span class="p">(</span><span class="n">Slot</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">),</span> <span class="ne">RuntimeError</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_trait</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">obj</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;cannot remove &#39;</span><span class="si">%s</span><span class="s">&#39;: not found&quot;</span> <span class="o">%</span>
                                 <span class="n">name</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">)</span>
</div>
    <span class="nd">@rbac</span><span class="p">((</span><span class="s">&#39;owner&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">))</span>
<div class="viewcode-block" id="Container.configure"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.configure">[docs]</a>    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</div>
    <span class="nd">@rbac</span><span class="p">((</span><span class="s">&#39;owner&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">))</span>
<div class="viewcode-block" id="Container.copy"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a deep copy without deepcopying the parent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">par</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cp</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">par</span>
            <span class="n">cp</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">par</span>
        <span class="k">return</span> <span class="n">cp</span>
</div>
    <span class="nd">@rbac</span><span class="p">((</span><span class="s">&#39;owner&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">))</span>
<div class="viewcode-block" id="Container.cpath_updated"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.cpath_updated">[docs]</a>    <span class="k">def</span> <span class="nf">cpath_updated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called after the hierarchy containing this Container has been</span>
<span class="sd">        defined back to the root. This does not guarantee that all sibling</span>
<span class="sd">        Containers have been defined. It also does not guarantee that this</span>
<span class="sd">        component is fully configured to execute. Classes that override this</span>
<span class="sd">        function must call their base class version.</span>

<span class="sd">        This version calls cpath_updated() on all of its child Containers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pathname</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;,&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_call_cpath_updated</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_containers</span><span class="p">():</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cont</span><span class="p">)</span><span class="o">.</span><span class="n">cpath_updated</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Container.revert_to_defaults"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.revert_to_defaults">[docs]</a>    <span class="k">def</span> <span class="nf">revert_to_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the values of all of the inputs to their default values.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_traits</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">recurse</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_containers</span><span class="p">():</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span><span class="o">.</span><span class="n">revert_to_defaults</span><span class="p">(</span><span class="n">recurse</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visited</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an iterator that returns a list of tuples of the form</span>
<span class="sd">        (rel_pathname, obj) for each trait of this Container that matches</span>
<span class="sd">        the given metadata. If recurse is True, also iterate through all</span>
<span class="sd">        child Containers of each Container found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
            <span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
            <span class="n">match_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alltraits</span><span class="p">(</span><span class="o">**</span><span class="n">metadata</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">recurse</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_containers</span><span class="p">():</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">match_dict</span> <span class="ow">and</span> <span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
                        <span class="k">yield</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">obj</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">chname</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">_items</span><span class="p">(</span><span class="n">visited</span><span class="p">,</span> <span class="n">recurse</span><span class="p">,</span>
                                                        <span class="o">**</span><span class="n">metadata</span><span class="p">):</span>
                            <span class="k">yield</span> <span class="p">(</span><span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">name</span><span class="p">,</span> <span class="n">chname</span><span class="p">]),</span> <span class="n">child</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">trait</span> <span class="ow">in</span> <span class="n">match_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">Missing</span><span class="p">)</span>
                <span class="c"># In some components with complex loading behavior (like</span>
                <span class="c"># NPSSComponent), we can have a temporary situation during</span>
                <span class="c"># loading where there are traits that don&#39;t point to anything,</span>
                <span class="c"># so check for them here and skip them if they don&#39;t point to</span>
                <span class="c"># anything.</span>
                <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Missing</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">Container</span><span class="p">,</span> <span class="n">VarTree</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">recurse</span><span class="p">:</span>
                            <span class="k">yield</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">trait</span><span class="o">.</span><span class="n">iotype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>

<div class="viewcode-block" id="Container.items"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.items">[docs]</a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of tuples of the form (rel_pathname, obj) for each</span>
<span class="sd">        trait of this Container that matches the given metadata. If recurse is</span>
<span class="sd">        True, also iterate through all child Containers of each Container</span>
<span class="sd">        found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)]),</span> <span class="n">recurse</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Container.list_containers"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.list_containers">[docs]</a>    <span class="k">def</span> <span class="nf">list_containers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of names of child Containers.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Container</span><span class="p">)]</span>
</div>
<div class="viewcode-block" id="Container.list_vars"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.list_vars">[docs]</a>    <span class="k">def</span> <span class="nf">list_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of Variables in this Container.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="n">not_none</span><span class="p">)]</span>
</div>
<div class="viewcode-block" id="Container.get_attributes"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.get_attributes">[docs]</a>    <span class="k">def</span> <span class="nf">get_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">io_only</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get attributes of this container. Includes all variables (&#39;Inputs&#39;)</span>
<span class="sd">            and, if *io_only* is not true, attributes for all slots as well.</span>

<span class="sd">            Arguments:</span>
<span class="sd">                io_only:  if True then only &#39;Inputs&#39; are included</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">attrs</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span>

        <span class="n">var_attrs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">io_only</span><span class="p">:</span>
            <span class="n">slot_attrs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slot_attrs</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c">#for name in self.list_vars() + self._added_traits.keys():</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_vars</span><span class="p">())</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_added_traits</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">_alltraits</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">Slot</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>

            <span class="n">trait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trait</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">ttype</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">trait_type</span>

            <span class="c"># Each variable type provides its own basic attributes</span>
            <span class="n">attr</span><span class="p">,</span> <span class="n">slot_attr</span> <span class="o">=</span> <span class="n">ttype</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">trait</span><span class="p">,</span> <span class="n">meta</span><span class="p">)</span>
            <span class="k">if</span> <span class="s">&#39;framework_var&#39;</span> <span class="ow">in</span> <span class="n">meta</span><span class="p">:</span>
                <span class="n">attr</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;~&#39;</span> <span class="o">+</span> <span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attr</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
            <span class="n">attr</span><span class="p">[</span><span class="s">&#39;indent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c"># Container variables are not connectable</span>
            <span class="n">attr</span><span class="p">[</span><span class="s">&#39;connected&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

            <span class="n">var_attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

            <span class="c"># Process slots</span>
            <span class="k">if</span> <span class="n">slot_attrs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">slot_attr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># slots can be hidden (e.g. the Workflow slot in drivers)</span>
                <span class="k">if</span> <span class="s">&#39;hidden&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">meta</span> <span class="ow">or</span> <span class="n">meta</span><span class="p">[</span><span class="s">&#39;hidden&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                    <span class="n">slot_attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slot_attr</span><span class="p">)</span>

        <span class="n">attrs</span><span class="p">[</span><span class="s">&#39;Inputs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">var_attrs</span>

        <span class="k">if</span> <span class="n">slot_attrs</span><span class="p">:</span>
            <span class="n">attrs</span><span class="p">[</span><span class="s">&#39;Slots&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">slot_attrs</span>
        <span class="k">return</span> <span class="n">attrs</span>

    <span class="c"># Can&#39;t use items() since it returns a generator (won&#39;t pickle).</span></div>
    <span class="nd">@rbac</span><span class="p">((</span><span class="s">&#39;owner&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_alltraits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traits</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This returns a dict that contains traits (class and instance)</span>
<span class="sd">        that match the given metadata.  If the &#39;traits&#39; argument is not</span>
<span class="sd">        None, then it is assumed to be the dict of traits to be filtered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">traits</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_traits_</span><span class="p">:</span>
                <span class="n">traits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_traits_</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">traits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">traits</span><span class="p">()</span>  <span class="c"># don&#39;t pass **metadata here</span>
                <span class="n">traits</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_instance_traits</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cached_traits_</span> <span class="o">=</span> <span class="n">traits</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">trait</span> <span class="ow">in</span> <span class="n">traits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">events</span> <span class="ow">and</span> <span class="n">trait</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="s">&#39;event&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">meta_name</span><span class="p">,</span> <span class="n">meta_eval</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">meta_eval</span><span class="p">)</span> <span class="ow">is</span> <span class="n">FunctionType</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">meta_eval</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">trait</span><span class="p">,</span> <span class="n">meta_name</span><span class="p">)):</span>
                        <span class="k">break</span>
                <span class="k">elif</span> <span class="n">meta_eval</span> <span class="o">!=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">trait</span><span class="p">,</span> <span class="n">meta_name</span><span class="p">):</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">trait</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@rbac</span><span class="p">((</span><span class="s">&#39;owner&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">))</span>
<div class="viewcode-block" id="Container.contains"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.contains">[docs]</a>    <span class="k">def</span> <span class="nf">contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return True if the child specified by the given dotted path</span>
<span class="sd">        name is contained in this Container.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">childname</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">restofpath</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">restofpath</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">childname</span><span class="p">,</span> <span class="n">Missing</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="n">Missing</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Container</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">restofpath</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">restofpath</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_get_metadata_failed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traitpath</span><span class="p">,</span> <span class="n">metaname</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t find metadata for trait </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">traitpath</span><span class="p">,</span>
                             <span class="ne">AttributeError</span><span class="p">)</span>

    <span class="nd">@rbac</span><span class="p">((</span><span class="s">&#39;owner&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">))</span>
<div class="viewcode-block" id="Container.get_metadata"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.get_metadata">[docs]</a>    <span class="k">def</span> <span class="nf">get_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traitpath</span><span class="p">,</span> <span class="n">metaname</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the metadata associated with the trait found using</span>
<span class="sd">        traitpath.  If metaname is None, return the entire metadata dictionary</span>
<span class="sd">        for the specified trait. Otherwise, just return the specified piece</span>
<span class="sd">        of metadata.  If the specified piece of metadata is not part of</span>
<span class="sd">        the trait, None is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">childname</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">restofpath</span> <span class="o">=</span> <span class="n">traitpath</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">restofpath</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">childname</span><span class="p">,</span> <span class="n">Missing</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="n">Missing</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_metadata_failed</span><span class="p">(</span><span class="n">traitpath</span><span class="p">,</span> <span class="n">metaname</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Container</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="n">restofpath</span><span class="p">,</span> <span class="n">metaname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># if the thing being accessed is an attribute of a Variable&#39;s</span>
                <span class="c"># data object, then we can assume that the iotype of the</span>
                <span class="c"># attribute is the same as the iotype of the Variable.</span>
                <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trait</span><span class="p">(</span><span class="n">childname</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">iotype</span> <span class="ow">and</span> <span class="n">metaname</span> <span class="o">==</span> <span class="s">&#39;iotype&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">iotype</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_get_metadata_failed</span><span class="p">(</span><span class="n">traitpath</span><span class="p">,</span> <span class="n">metaname</span><span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trait</span><span class="p">(</span><span class="n">traitpath</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_metadata_failed</span><span class="p">(</span><span class="n">traitpath</span><span class="p">,</span> <span class="n">metaname</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">trait_type</span>
        <span class="k">if</span> <span class="n">metaname</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">mdict</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">mdict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;vartypename&#39;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">mdict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metaname</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="c"># vartypename isn&#39;t present in the metadata of traits</span>
            <span class="c"># that don&#39;t inherit from Variable, so fake it out here</span>
            <span class="c"># so we&#39;ll be consistent across all traits</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">metaname</span> <span class="o">==</span> <span class="s">&#39;vartypename&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
            <span class="k">return</span> <span class="n">val</span>
</div>
    <span class="k">def</span> <span class="nf">_get_failed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;If get() cannot locate the variable specified by the given</span>
<span class="sd">        path, either because the parent object is not a Container or because</span>
<span class="sd">        getattr() fails, raise an exception.  Inherited classes can override</span>
<span class="sd">        this to return the value of the specified variable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">):</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">),</span> <span class="ne">AttributeError</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">get_indexed_value</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

    <span class="nd">@rbac</span><span class="p">((</span><span class="s">&#39;owner&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">),</span> <span class="n">proxy_types</span><span class="o">=</span><span class="p">[</span><span class="n">FileRef</span><span class="p">])</span>
<div class="viewcode-block" id="Container.get"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the object specified by the given path, which may</span>
<span class="sd">        contain &#39;.&#39; characters.  *index*, if not None,</span>
<span class="sd">        should be either a list of non-tuple hashable objects (at most one</span>
<span class="sd">        for each array dimension of the target value) or a list of tuples of</span>
<span class="sd">        the form (operation_id, stuff).</span>

<span class="sd">        The forms of the various tuples are:</span>

<span class="sd">        ::</span>

<span class="sd">            INDEX:   (0, idx)</span>
<span class="sd">                where idx is some hashable value</span>
<span class="sd">            ATTR:    (1, name)</span>
<span class="sd">                where name is the attribute name</span>
<span class="sd">            CALL:    (2, args, kwargs)</span>
<span class="sd">                where args is a list of values and kwargs is a list of</span>
<span class="sd">                tuples of the form (keyword,value).</span>
<span class="sd">                kwargs can be left out if empty.  args can be left out</span>
<span class="sd">                if empty as long as kwargs are also empty, for example,</span>
<span class="sd">                (2,) and (2,[],[(&#39;foo&#39;,1)]) are valid but (2,[(&#39;foo&#39;,1)]) is not.</span>
<span class="sd">            SLICE:   (3, lower, upper, step)</span>
<span class="sd">                All members must be present and should have a value</span>
<span class="sd">                of None if not set.</span>

<span class="sd">        If you want to use a tuple as a key into a dict, you&#39;ll have to</span>
<span class="sd">        nest your key tuple inside of an INDEX tuple to avoid ambiguity,</span>
<span class="sd">        for example, (0, my_tuple).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">childname</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">restofpath</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">restofpath</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">childname</span><span class="p">,</span> <span class="n">Missing</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="n">Missing</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Container</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_failed</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">restofpath</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;[&#39;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                <span class="n">path</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">idx</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                        <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">Missing</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span>
                    <span class="k">elif</span> <span class="n">idx</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">):</span>  <span class="c"># ndarray index</span>
                        <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">Missing</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="n">Missing</span><span class="p">:</span>
                            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_failed</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
                        <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">:</span>
                            <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
                        <span class="k">return</span> <span class="n">obj</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">|&quot;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>  <span class="c"># strip any quotes</span>
                        <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">Missing</span><span class="p">)[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">Missing</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="n">Missing</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_failed</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">get_indexed_value</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_set_failed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;If set() cannot locate the specified variable, raise an exception.</span>
<span class="sd">        Inherited classes can override this to locate the variable elsewhere</span>
<span class="sd">        and set its value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;object has no attribute &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">,</span>
                             <span class="ne">AttributeError</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">src</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Raise an exception if the given source variable is not the one</span>
<span class="sd">        that is connected to the destination variable specified by &#39;path&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_depgraph</span><span class="o">.</span><span class="n">get_source</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">src</span> <span class="o">!=</span> <span class="n">source</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span>
                <span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39; is connected to source &#39;</span><span class="si">%s</span><span class="s">&#39; and cannot be &quot;</span>
                <span class="s">&quot;set by source &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span>
                <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">src</span><span class="p">),</span> <span class="ne">RuntimeError</span><span class="p">)</span>

<div class="viewcode-block" id="Container.get_iotype"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.get_iotype">[docs]</a>    <span class="k">def</span> <span class="nf">get_iotype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trait</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">iotype</span>
</div>
    <span class="nd">@rbac</span><span class="p">((</span><span class="s">&#39;owner&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">))</span>
<div class="viewcode-block" id="Container.set"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the value of the Variable specified by the given path, which</span>
<span class="sd">        may contain &#39;.&#39; characters. The Variable will be set to the given</span>
<span class="sd">        value, subject to validation and constraints. *index*, if not None,</span>
<span class="sd">        should be either a list of non-tuple hashable objects, at most one</span>
<span class="sd">        for each array dimension of the target value, or a list of tuples of</span>
<span class="sd">        the form (operation_id, stuff).</span>

<span class="sd">        The forms of the various tuples are:</span>

<span class="sd">        ::</span>

<span class="sd">            INDEX:   (0, idx)</span>
<span class="sd">                where idx is some hashable value</span>
<span class="sd">            ATTR:    (1, name)</span>
<span class="sd">                where name is the attribute name</span>
<span class="sd">            CALL:    (2, args, kwargs)</span>
<span class="sd">                where args is a list of values, and kwargs is a list of</span>
<span class="sd">                tuples of the form (keyword,value).</span>
<span class="sd">                kwargs can be left out if empty.  args can be left out</span>
<span class="sd">                if empty as long as kwargs are also empty, for example,</span>
<span class="sd">                (2,) and (2,[],[(&#39;foo&#39;,1)]) are valid but (2,[(&#39;foo&#39;,1)]) is not.</span>
<span class="sd">            SLICE:   (3, lower, upper, step)</span>
<span class="sd">                All members must be present and should have a value</span>
<span class="sd">                of None if not set.</span>

<span class="sd">        If you want to use a tuple as a key into a dict, you&#39;ll have to</span>
<span class="sd">        nest your key tuple inside of an INDEX tuple to avoid ambiguity,</span>
<span class="sd">        for example, (0, my_tuple)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">childname</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">restofpath</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">restofpath</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">childname</span><span class="p">,</span> <span class="n">Missing</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="n">Missing</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Container</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_failed</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">src</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">ExprEvaluator</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">scope_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">restofpath</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="n">src</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">iotype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_iotype</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_failed</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">iotype</span> <span class="o">==</span> <span class="s">&#39;in&#39;</span> <span class="ow">or</span> <span class="n">src</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>  <span class="c"># setting an input or a boundary output, so have to check source</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_check_source</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="c"># bypass input source checking</span>
                    <span class="n">chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_check</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_input_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_nocheck</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                    <span class="k">finally</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_input_check</span> <span class="o">=</span> <span class="n">chk</span>
                    <span class="c"># Note: This was done to make foo.bar = 3 behave the</span>
                    <span class="c"># same as foo.set(&#39;bar&#39;, 3).</span>
                    <span class="c"># Without this, the output of the comp was</span>
                    <span class="c"># always invalidated when you call set_parameters.</span>
                    <span class="c"># This meant that component was always executed</span>
                    <span class="c"># even when the inputs were unchanged.</span>
                    <span class="c"># _call_execute is set in the on-trait-changed</span>
                    <span class="c"># callback, so it&#39;s a good test for whether the</span>
                    <span class="c"># value changed.</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;_call_execute&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_execute</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_input_updated</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c"># array index specified</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_index_set</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">iotype</span> <span class="o">==</span> <span class="s">&#39;out&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&#39;Cannot set output </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">,</span>
                                     <span class="ne">RuntimeError</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">index</span><span class="p">:</span>  <span class="c"># array index specified</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_index_set</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_index_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wrapped_attr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">AttrWrapper</span><span class="p">):</span>
            <span class="n">wrapper</span> <span class="o">=</span> <span class="n">obj</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wrapper</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">AttrWrapper</span><span class="p">):</span>
            <span class="n">truval</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span>
            <span class="k">if</span> <span class="n">wrapper</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ATTR</span><span class="p">:</span>
                    <span class="n">truval</span> <span class="o">=</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">convert_from</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Container</span><span class="p">):</span>
                    <span class="n">att</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_wrapped_attr</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">att</span><span class="p">,</span> <span class="n">AttrWrapper</span><span class="p">):</span>
                        <span class="n">truval</span> <span class="o">=</span> <span class="n">att</span><span class="o">.</span><span class="n">convert_from</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">truval</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">old</span> <span class="o">=</span> <span class="n">process_index_entry</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">old</span> <span class="o">=</span> <span class="n">_missing</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">INDEX</span><span class="p">:</span>
                <span class="n">obj</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">ATTR</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">SLICE</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c"># setting of individual Array entries or sub attributes doesn&#39;t seem to</span>
        <span class="c"># trigger _input_trait_modified, so do it manually</span>
        <span class="c"># FIXME: if people register other callbacks on a trait, they won&#39;t</span>
        <span class="c">#        be called if we do it this way</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="p">(</span><span class="n">old</span> <span class="o">==</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>  <span class="c"># FIXME: probably a numpy sub-array. assume value has changed for now...</span>
            <span class="n">eq</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">eq</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_call_execute</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_dict</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_input_updated</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_input_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">old</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This raises an exception if the specified input is attached</span>
<span class="sd">        to a source.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_depgraph</span><span class="o">.</span><span class="n">get_source</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="c"># bypass the callback here and set it back to the old value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trait_change_notify</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">old</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_trait_change_notify</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span>
                <span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39; is already connected to source &#39;</span><span class="si">%s</span><span class="s">&#39; and &quot;</span>
                <span class="s">&quot;cannot be directly set&quot;</span> <span class="o">%</span>
                <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_depgraph</span><span class="o">.</span><span class="n">get_source</span><span class="p">(</span><span class="n">name</span><span class="p">)),</span> <span class="ne">RuntimeError</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_input_nocheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">old</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This method is substituted for `_input_check` to avoid source</span>
<span class="sd">        checking during a set() call when we&#39;ve already verified the source.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_add_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds our pathname to the beginning of the given message.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pathname</span><span class="p">(),</span> <span class="n">msg</span><span class="p">)</span>

<div class="viewcode-block" id="Container.save_to_egg"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.save_to_egg">[docs]</a>    <span class="k">def</span> <span class="nf">save_to_egg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">py_dir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">src_dir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                    <span class="n">src_files</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">child_objs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dst_dir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                    <span class="n">observer</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">need_requirements</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save state and other files to an egg.  Typically used to copy all or</span>
<span class="sd">        part of a simulation to another user or machine.  By specifying child</span>
<span class="sd">        containers in `child_objs`, it will be possible to create instances of</span>
<span class="sd">        just those containers from the installed egg.  Child container names</span>
<span class="sd">        should be specified relative to this container.</span>

<span class="sd">        name: string</span>
<span class="sd">            Name for egg; must be an alphanumeric string.</span>

<span class="sd">        version: string</span>
<span class="sd">            Version for egg; must be an alphanumeric string.</span>

<span class="sd">        py_dir: string</span>
<span class="sd">            The (root) directory for local Python files. It defaults to</span>
<span class="sd">            the current directory.</span>

<span class="sd">        src_dir: string</span>
<span class="sd">            The root of all (relative) `src_files`.</span>

<span class="sd">        src_files: list</span>
<span class="sd">            List of paths to files to be included in the egg.</span>

<span class="sd">        child_objs: list</span>
<span class="sd">            List of child objects for additional entry points.</span>

<span class="sd">        dst_dir: string</span>
<span class="sd">            The directory to write the egg in.</span>

<span class="sd">        observer: callable</span>
<span class="sd">            Will be called via an :class:`EggObserver`.</span>

<span class="sd">        need_requirements: bool</span>
<span class="sd">            Passed to :meth:`eggsaver.save_to_egg`.</span>

<span class="sd">        After collecting entry point information, calls</span>
<span class="sd">        :meth:`eggsaver.save_to_egg`.</span>
<span class="sd">        Returns ``(egg_filename, required_distributions, orphan_modules)``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">name</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">version</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">version</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">):</span>
            <span class="n">version</span> <span class="o">+=</span> <span class="s">&#39;.&#39;</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>  <span class="c"># Could consider using utcnow().</span>
        <span class="n">tstamp</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%d</span><span class="s">.</span><span class="si">%02d</span><span class="s">.</span><span class="si">%02d</span><span class="s">.</span><span class="si">%02d</span><span class="s">.</span><span class="si">%02d</span><span class="s">&#39;</span> <span class="o">%</span> \
                 <span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span>
        <span class="n">version</span> <span class="o">+=</span> <span class="n">tstamp</span>

        <span class="n">observer</span> <span class="o">=</span> <span class="n">eggobserver</span><span class="o">.</span><span class="n">EggObserver</span><span class="p">(</span><span class="n">observer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

        <span class="c"># Child entry point names are the pathname, starting at self.</span>
        <span class="n">entry_pts</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">_get_entry_group</span><span class="p">(</span><span class="bp">self</span><span class="p">))]</span>
        <span class="k">if</span> <span class="n">child_objs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">root_pathname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pathname</span><span class="p">()</span>
            <span class="n">root_start</span> <span class="o">=</span> <span class="n">root_pathname</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
            <span class="n">root_start</span> <span class="o">=</span> <span class="n">root_start</span><span class="o">+</span><span class="mi">1</span> <span class="k">if</span> <span class="n">root_start</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">root_pathname</span> <span class="o">+=</span> <span class="s">&#39;.&#39;</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">child_objs</span><span class="p">:</span>
                <span class="n">pathname</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">get_pathname</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">pathname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">root_pathname</span><span class="p">):</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> is not a child of </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pathname</span><span class="p">,</span> <span class="n">root_pathname</span><span class="p">)</span>
                    <span class="n">observer</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">RuntimeError</span><span class="p">)</span>
                <span class="n">entry_pts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">child</span><span class="p">,</span> <span class="n">pathname</span><span class="p">[</span><span class="n">root_start</span><span class="p">:],</span>
                                  <span class="n">_get_entry_group</span><span class="p">(</span><span class="n">child</span><span class="p">)))</span>

        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c"># Don&#39;t want to save stuff above us.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">eggsaver</span><span class="o">.</span><span class="n">save_to_egg</span><span class="p">(</span><span class="n">entry_pts</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">py_dir</span><span class="p">,</span>
                                        <span class="n">src_dir</span><span class="p">,</span> <span class="n">src_files</span><span class="p">,</span> <span class="n">dst_dir</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span> <span class="n">observer</span><span class="o">.</span><span class="n">observer</span><span class="p">,</span>
                                        <span class="n">need_requirements</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reraise_exception</span><span class="p">()</span>  <span class="c"># Just to get a pathname.</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
</div>
<div class="viewcode-block" id="Container.save"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outstream</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">SAVE_CPICKLE</span><span class="p">,</span> <span class="n">proto</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the state of this object and its children to the given</span>
<span class="sd">        output stream. Pure Python classes generally won&#39;t need to</span>
<span class="sd">        override this because the base class version will suffice, but</span>
<span class="sd">        Python extension classes will have to override. The format</span>
<span class="sd">        can be supplied in case something other than cPickle is needed.</span>

<span class="sd">        outstream: file or string</span>
<span class="sd">            Stream to save to.</span>

<span class="sd">        fmt: int</span>
<span class="sd">            Format for saved data.</span>

<span class="sd">        proto: int</span>
<span class="sd">            Protocol used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c"># Don&#39;t want to save stuff above us.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">eggsaver</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outstream</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">proto</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reraise_exception</span><span class="p">()</span>  <span class="c"># Just to get a pathname.</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Container.load_from_eggfile"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.load_from_eggfile">[docs]</a>    <span class="k">def</span> <span class="nf">load_from_eggfile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">observer</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extract files in egg to a subdirectory matching the saved object</span>
<span class="sd">        name and then load object graph state.</span>

<span class="sd">        filename: string</span>
<span class="sd">            Name of egg file to be loaded.</span>

<span class="sd">        observer: callable</span>
<span class="sd">            Will be called via an :class:`EggObserver`.</span>

<span class="sd">        log: :class:`logging.Logger`</span>
<span class="sd">            Used for logging progress, default is root logger.</span>

<span class="sd">        Returns the root object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Load from file gets everything.</span>
        <span class="n">entry_group</span> <span class="o">=</span> <span class="s">&#39;openmdao.top&#39;</span>
        <span class="n">entry_name</span> <span class="o">=</span> <span class="s">&#39;top&#39;</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">log</span> <span class="ow">or</span> <span class="n">logger</span>
        <span class="k">return</span> <span class="n">eggloader</span><span class="o">.</span><span class="n">load_from_eggfile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">entry_group</span><span class="p">,</span> <span class="n">entry_name</span><span class="p">,</span>
                                           <span class="n">log</span><span class="p">,</span> <span class="n">observer</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Container.load_from_eggpkg"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.load_from_eggpkg">[docs]</a>    <span class="k">def</span> <span class="nf">load_from_eggpkg</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">entry_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">instance_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                         <span class="n">observer</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load object graph state by invoking the given package entry point.</span>
<span class="sd">        If specified, the root object is renamed to `instance_name`.</span>

<span class="sd">        package: string</span>
<span class="sd">            Package name.</span>

<span class="sd">        entry_name: string</span>
<span class="sd">            Name of entry point.</span>

<span class="sd">        instance_name: string</span>
<span class="sd">            Name for root object.</span>

<span class="sd">        observer: callable</span>
<span class="sd">            Will be called via an :class:`EggObserver`.</span>

<span class="sd">        Returns the root object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entry_group</span> <span class="o">=</span> <span class="s">&#39;openmdao.component&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entry_name</span><span class="p">:</span>
            <span class="n">entry_name</span> <span class="o">=</span> <span class="n">package</span>  <span class="c"># Default component is top.</span>
        <span class="k">return</span> <span class="n">eggloader</span><span class="o">.</span><span class="n">load_from_eggpkg</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">entry_group</span><span class="p">,</span> <span class="n">entry_name</span><span class="p">,</span>
                                          <span class="n">instance_name</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">observer</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Container.load"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">instream</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">SAVE_CPICKLE</span><span class="p">,</span> <span class="n">package</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">call_post_load</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
             <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load object(s) from the input stream. Pure Python classes generally</span>
<span class="sd">        won&#39;t need to override this, but extensions will. The format can be</span>
<span class="sd">        supplied in case something other than cPickle is needed.</span>

<span class="sd">        instream: file or string</span>
<span class="sd">            Stream to load from.</span>

<span class="sd">        fmt: int</span>
<span class="sd">            Format of state data.</span>

<span class="sd">        package: string</span>
<span class="sd">            Name of package to look for `instream`, if `instream` is a string</span>
<span class="sd">            that is not an existing file.</span>

<span class="sd">        call_post_load: bool</span>
<span class="sd">            If True, call :meth:`post_load`.</span>

<span class="sd">        name: string</span>
<span class="sd">            Name for root object.</span>

<span class="sd">        Returns the root object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">top</span> <span class="o">=</span> <span class="n">eggloader</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">instream</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">package</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
        <span class="n">top</span><span class="o">.</span><span class="n">cpath_updated</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">top</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">call_post_load</span><span class="p">:</span>
            <span class="n">top</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">top</span><span class="o">.</span><span class="n">post_load</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">top</span>
</div>
<div class="viewcode-block" id="Container.post_load"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.post_load">[docs]</a>    <span class="k">def</span> <span class="nf">post_load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Perform any required operations after model has been loaded.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_containers</span><span class="p">():</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">post_load</span><span class="p">()</span>
</div>
    <span class="nd">@rbac</span><span class="p">(</span><span class="s">&#39;owner&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="Container.pre_delete"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.pre_delete">[docs]</a>    <span class="k">def</span> <span class="nf">pre_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Perform any required operations before the model is deleted.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_containers</span><span class="p">():</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">pre_delete</span><span class="p">()</span>
</div>
    <span class="nd">@rbac</span><span class="p">((</span><span class="s">&#39;owner&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">),</span> <span class="n">proxy_types</span><span class="o">=</span><span class="p">[</span><span class="n">CTrait</span><span class="p">])</span>
<div class="viewcode-block" id="Container.get_dyn_trait"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.get_dyn_trait">[docs]</a>    <span class="k">def</span> <span class="nf">get_dyn_trait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathname</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">trait</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a trait if a trait with the given pathname exists, possibly</span>
<span class="sd">        creating it &quot;on-the-fly&quot; and adding its Container. If an attribute exists</span>
<span class="sd">        with the given pathname but no trait is found or can be created, or if</span>
<span class="sd">        pathname references a trait in a parent scope, None will be returned.</span>
<span class="sd">        If no attribute exists with the given pathname within this scope, an</span>
<span class="sd">        AttributeError will be raised.</span>

<span class="sd">        pathname: str</span>
<span class="sd">            Pathname of the desired trait.  May contain dots.</span>

<span class="sd">        iotype: str (optional)</span>
<span class="sd">            Expected iotype of the trait.</span>

<span class="sd">        trait: TraitType (optional)</span>
<span class="sd">            Trait to be used for validation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pathname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;parent.&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">cname</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">restofpath</span> <span class="o">=</span> <span class="n">pathname</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">restofpath</span><span class="p">:</span>
            <span class="n">child</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">Container</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">child</span><span class="o">.</span><span class="n">get_dyn_trait</span><span class="p">(</span><span class="n">restofpath</span><span class="p">,</span> <span class="n">iotype</span><span class="p">,</span> <span class="n">trait</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">deep_hasattr</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">restofpath</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trait</span><span class="p">(</span><span class="n">cname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">trait</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">iotype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trait</span><span class="o">.</span><span class="n">trait_type</span><span class="p">,</span> <span class="n">Python</span><span class="p">):</span>  <span class="c"># VariableTree</span>
                        <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span>
                        <span class="n">t_iotype</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;iotype&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>  <span class="c"># Variable</span>
                        <span class="n">t_iotype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_iotype</span><span class="p">(</span><span class="n">cname</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">t_iotype</span> <span class="o">!=</span> <span class="n">iotype</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> must be an </span><span class="si">%s</span><span class="s"> variable&#39;</span> <span class="o">%</span>
                                             <span class="p">(</span><span class="n">pathname</span><span class="p">,</span> <span class="n">_iodict</span><span class="p">[</span><span class="n">iotype</span><span class="p">]),</span>
                                             <span class="ne">RuntimeError</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">trait</span>
            <span class="k">elif</span> <span class="n">trait</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">cname</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;Cannot locate variable named &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span>
                             <span class="n">pathname</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">)</span>
</div>
    <span class="nd">@rbac</span><span class="p">((</span><span class="s">&#39;owner&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">))</span>
<div class="viewcode-block" id="Container.get_trait_typenames"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.get_trait_typenames">[docs]</a>    <span class="k">def</span> <span class="nf">get_trait_typenames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathname</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return names of the &#39;final&#39; type (bypassing passthrough traits)</span>
<span class="sd">        for `pathname` using :meth:`get_dyn_trait`. Used by dynamic wrappers</span>
<span class="sd">        to determine the type of variable to wrap. The returned list is a</span>
<span class="sd">        depth-first traversal of the class hierarchy.</span>

<span class="sd">        pathname: str</span>
<span class="sd">            Pathname of the desired trait. May contain dots.</span>

<span class="sd">        iotype: str (optional)</span>
<span class="sd">            Expected iotype of the trait.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pathname</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dyn_trait</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="n">iotype</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">trait</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>

            <span class="n">trait</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">trait_type</span> <span class="ow">or</span> <span class="n">trait</span><span class="o">.</span><span class="n">trait</span> <span class="ow">or</span> <span class="n">trait</span>
            <span class="k">if</span> <span class="n">trait</span><span class="o">.</span><span class="n">target</span><span class="p">:</span>  <span class="c"># PassthroughTrait, PassthroughProperty</span>
                <span class="n">trait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dyn_trait</span><span class="p">(</span><span class="n">trait</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ttype</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">trait_type</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ttype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">trait</span> <span class="o">=</span> <span class="n">ttype</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trait</span><span class="p">,</span> <span class="n">Python</span><span class="p">):</span>  <span class="c"># Container</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pathname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c"># Variable</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">trait</span>

        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Container</span><span class="o">.</span><span class="n">_bases</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">names</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">names</span>
</div>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_bases</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Helper for :meth:`get_trait_typenames`. &quot;&quot;&quot;</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span> <span class="n">cls</span><span class="o">.</span><span class="n">__name__</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">__bases__</span><span class="p">:</span>
            <span class="n">Container</span><span class="o">.</span><span class="n">_bases</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>

<div class="viewcode-block" id="Container.raise_exception"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.raise_exception">[docs]</a>    <span class="k">def</span> <span class="nf">raise_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">exception_class</span><span class="o">=</span><span class="ne">Exception</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Raise an exception.&quot;&quot;&quot;</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">while</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">coords</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_itername</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">coords</span><span class="p">:</span>
            <span class="n">full_msg</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">): </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pathname</span><span class="p">(),</span> <span class="n">coords</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">full_msg</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pathname</span><span class="p">(),</span> <span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">exception_class</span><span class="p">(</span><span class="n">full_msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Container.reraise_exception"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.reraise_exception">[docs]</a>    <span class="k">def</span> <span class="nf">reraise_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Re-raise an exception with updated message and original traceback.&quot;&quot;&quot;</span>
        <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">exc_value</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pathname</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">msg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">msg</span>
        <span class="n">new_exc</span> <span class="o">=</span> <span class="n">exc_type</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="nb">type</span><span class="p">(</span><span class="n">new_exc</span><span class="p">),</span> <span class="n">new_exc</span><span class="p">,</span> <span class="n">exc_traceback</span>
</div>
<div class="viewcode-block" id="Container.build_trait"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.Container.build_trait">[docs]</a>    <span class="k">def</span> <span class="nf">build_trait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_name</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">trait</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build a trait referring to `ref_name`.</span>
<span class="sd">        This is called by :meth:`create_io_traits`.</span>
<span class="sd">        This must be overridden.</span>

<span class="sd">        iotype: str or dict</span>
<span class="sd">            If `iotype` is a string it specifies the trait&#39;s iotype.</span>
<span class="sd">            If it&#39;s a dictionary, it provides metadata.</span>

<span class="sd">        trait: Trait</span>
<span class="sd">            If `trait` is not None, use that trait rather than building one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&#39;build_trait()&#39;</span><span class="p">,</span> <span class="ne">NotImplementedError</span><span class="p">)</span>

<span class="c"># By default we always proxy Containers and FileRefs.</span></div></div>
<span class="n">CLASSES_TO_PROXY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Container</span><span class="p">)</span>
<span class="n">CLASSES_TO_PROXY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FileRef</span><span class="p">)</span>


<span class="c"># Some utility functions</span>


<span class="k">def</span> <span class="nf">_get_entry_group</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return entry point group for given object type.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">_get_entry_group</span><span class="o">.</span><span class="n">group_map</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c"># Fill-in here to avoid import loop.</span>
        <span class="kn">from</span> <span class="nn">openmdao.main.component</span> <span class="kn">import</span> <span class="n">Component</span>
        <span class="kn">from</span> <span class="nn">openmdao.main.driver</span> <span class="kn">import</span> <span class="n">Driver</span>

        <span class="c"># Entry point definitions taken from plugin-guide.</span>
        <span class="c"># Order should be from most-specific to least.</span>
        <span class="n">_get_entry_group</span><span class="o">.</span><span class="n">group_map</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">Variable</span><span class="p">,</span>             <span class="s">&#39;openmdao.variable&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">IParametricGeometry</span><span class="p">,</span>  <span class="s">&#39;openmdao.parametric_geometry&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">Driver</span><span class="p">,</span>               <span class="s">&#39;openmdao.driver&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">ICaseIterator</span><span class="p">,</span>        <span class="s">&#39;openmdao.case_iterator&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">IResourceAllocator</span><span class="p">,</span>   <span class="s">&#39;openmdao.resource_allocator&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">Component</span><span class="p">,</span>            <span class="s">&#39;openmdao.component&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">Container</span><span class="p">,</span>            <span class="s">&#39;openmdao.container&#39;</span><span class="p">),</span>
        <span class="p">]</span>

    <span class="k">for</span> <span class="n">cls</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">_get_entry_group</span><span class="o">.</span><span class="n">group_map</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">Interface</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">cls</span><span class="o">.</span><span class="n">providedBy</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">group</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">cls</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">group</span>
    <span class="k">return</span> <span class="bp">None</span>

<span class="n">_get_entry_group</span><span class="o">.</span><span class="n">group_map</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c"># Map from class/interface to group name.</span>


<div class="viewcode-block" id="dump"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.dump">[docs]</a><span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Print all items having specified metadata and</span>
<span class="sd">    their corresponding values to the given stream. If the stream</span>
<span class="sd">    is not supplied, it defaults to *sys.stdout*.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="nb">dict</span><span class="p">([(</span><span class="n">n</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cont</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">recurse</span><span class="o">=</span><span class="n">recurse</span><span class="p">,</span>
                                           <span class="o">**</span><span class="n">metadata</span><span class="p">)]),</span>
                  <span class="n">stream</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="find_name"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.find_name">[docs]</a><span class="k">def</span> <span class="nf">find_name</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Find the given object in the specified parent and return its name</span>
<span class="sd">    in the parent&#39;s `__dict__`.  There could be multiple names bound to a</span>
<span class="sd">    given object. Only the first name found is returned.</span>

<span class="sd">    Return &#39;&#39; if not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="n">obj</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">name</span>
    <span class="k">return</span> <span class="s">&#39;&#39;</span>

</div>
<div class="viewcode-block" id="get_default_name"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.get_default_name">[docs]</a><span class="k">def</span> <span class="nf">get_default_name</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">scope</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a unique name for the given object in the given scope.&quot;&quot;&quot;</span>
    <span class="n">classname</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">scope</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">sdict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sdict</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">__dict__</span>

    <span class="n">ver</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="s">&#39;</span><span class="si">%s%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">classname</span><span class="p">,</span> <span class="n">ver</span><span class="p">)</span> <span class="ow">in</span> <span class="n">sdict</span><span class="p">:</span>
        <span class="n">ver</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">classname</span><span class="p">,</span> <span class="n">ver</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="deep_hasattr"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.deep_hasattr">[docs]</a><span class="k">def</span> <span class="nf">deep_hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">pathname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns True if the attrbute indicated by the given pathname</span>
<span class="sd">    exists; False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">pathname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

</div>
<div class="viewcode-block" id="deep_getattr"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.deep_getattr">[docs]</a><span class="k">def</span> <span class="nf">deep_getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">pathname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the attrbute indicated by the given pathname or raises</span>
<span class="sd">    an exception if it doesn&#39;t exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">pathname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obj</span>

</div>
<div class="viewcode-block" id="find_trait_and_value"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.find_trait_and_value">[docs]</a><span class="k">def</span> <span class="nf">find_trait_and_value</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">pathname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a tuple of the form (trait, value) for the given dotted</span>
<span class="sd">    pathname. Raises an exception if the value indicated by the pathname</span>
<span class="sd">    is not found in obj. If the value is found but has no trait, then</span>
<span class="sd">    (None, value) is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">names</span> <span class="o">=</span> <span class="n">pathname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Container</span><span class="p">):</span>
        <span class="n">objtrait</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_trait</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">HasTraits</span><span class="p">):</span>
        <span class="n">objtrait</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">objtrait</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">objtrait</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

</div>
<div class="viewcode-block" id="create_io_traits"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.container.create_io_traits">[docs]</a><span class="k">def</span> <span class="nf">create_io_traits</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="n">obj_info</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create io trait(s) specified by the contents of `obj_info`. Calls</span>
<span class="sd">    :meth:`build_trait` on :class:`Container` `cont`, which can be overridden</span>
<span class="sd">    by subclasses, to create each trait.  One use of this is to provide traits</span>
<span class="sd">    mapping to variables inside a :class:`Component` implemented as a Python</span>
<span class="sd">    extension module.</span>

<span class="sd">    `obj_info` is assumed to be either a string, a tuple, or a list</span>
<span class="sd">    that contains strings and/or tuples.  The information is used to specify</span>
<span class="sd">    the &quot;internal&quot; and &quot;external&quot; names of the variable.</span>
<span class="sd">    The &quot;internal&quot; name uses the naming scheme within the Container.</span>
<span class="sd">    The &quot;external&quot; name is the one that will be used to access the trait</span>
<span class="sd">    from outside the Container; it must not contain any &#39;.&#39; characters.</span>

<span class="sd">    A string specifies the &quot;internal&quot; name for the variable.  The &quot;external&quot;</span>
<span class="sd">    name will be the &quot;internal&quot; name with any &#39;.&#39; characters replaced by &#39;_&#39;.</span>

<span class="sd">    Tuples must contain the &quot;internal&quot; name followed by the &quot;external&quot; name</span>
<span class="sd">    and may optionally contain an iotype and a validation trait. If the iotype</span>
<span class="sd">    is a dictionary rather than a string, it is used for trait metadata (it may</span>
<span class="sd">    include the ``iotype`` key but does not have to).</span>

<span class="sd">    `iotype` is the default I/O type to be used.</span>

<span class="sd">    The newly created traits are added to the specified Container.</span>

<span class="sd">    For example, the following are valid calls::</span>

<span class="sd">        # Create an input trait &#39;foo&#39; referring to &#39;foo&#39; on &#39;obj&#39;.</span>
<span class="sd">        create_io_traits(obj, &#39;foo&#39;)</span>

<span class="sd">        # Create an input trait &#39;inputs_foo&#39; referring to &#39;inputs.foo&#39;.</span>
<span class="sd">        create_io_traits(obj, &#39;inputs.foo&#39;)</span>

<span class="sd">        # Create outputs &#39;foo&#39;, &#39;bar&#39;, and &#39;baz&#39;.</span>
<span class="sd">        create_io_traits(obj, [&#39;foo&#39;,&#39;bar&#39;,&#39;baz&#39;], iotype=&#39;out&#39;)</span>

<span class="sd">        # Use Bool trait named &#39;foo_alias&#39; to refer to &#39;foo&#39;, and create &#39;bar&#39;.</span>
<span class="sd">        create_io_traits(obj, (&#39;foo&#39;, &#39;foo_alias&#39;, &#39;in&#39;, Bool()), &#39;bar&#39;)</span>

<span class="sd">        # Create inputs &#39;fooa&#39; and &#39;bazz&#39;, and output &#39;barb&#39;.</span>
<span class="sd">        # &#39;fooa&#39; will have the specified metadata.</span>
<span class="sd">        create_io_traits(obj, [(&#39;foo&#39;, &#39;fooa&#39;, {low=-1, high=10}),</span>
<span class="sd">                               (&#39;bar&#39;, &#39;barb&#39;, &#39;out&#39;),</span>
<span class="sd">                               (&#39;baz&#39;, &#39;bazz&#39;)])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj_info</span><span class="p">,</span> <span class="p">(</span><span class="nb">basestring</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">it</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj_info</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">it</span> <span class="o">=</span> <span class="n">obj_info</span>

    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
        <span class="n">iostat</span> <span class="o">=</span> <span class="n">iotype</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">ref_name</span> <span class="o">=</span> <span class="n">entry</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">ref_name</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c"># internal name</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">ref_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">)</span>  <span class="c"># wrapper name</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">iostat</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c"># optional iotype/metadata</span>
                <span class="n">trait</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>   <span class="c"># optional validation trait</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cont</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&#39;create_io_traits cannot add trait </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">entry</span><span class="p">,</span>
                                 <span class="ne">RuntimeError</span><span class="p">)</span>

        <span class="k">if</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">cont</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;Can&#39;t create &#39;</span><span class="si">%s</span><span class="s">&#39; because it&#39;s a&quot;</span>
                                 <span class="s">&quot; dotted pathname&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">)</span>

        <span class="n">newtrait</span> <span class="o">=</span> <span class="n">cont</span><span class="o">.</span><span class="n">get_trait</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">newtrait</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cont</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span>
                <span class="s">&quot;Can&#39;t create &#39;</span><span class="si">%s</span><span class="s">&#39; because it already exists.&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span>
                <span class="ne">RuntimeError</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">cont</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">ref_name</span><span class="p">):</span>
            <span class="n">cont</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;Can&#39;t create trait for &#39;</span><span class="si">%s</span><span class="s">&#39; because it wasn&#39;t&quot;</span>
                                 <span class="s">&quot; found&quot;</span> <span class="o">%</span> <span class="n">ref_name</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">)</span>

        <span class="n">cont</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">cont</span><span class="o">.</span><span class="n">build_trait</span><span class="p">(</span><span class="n">ref_name</span><span class="p">,</span> <span class="n">iostat</span><span class="p">,</span> <span class="n">trait</span><span class="p">))</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<a href="http://openmdao.org">
 <img src="../../../_static/OpenMDAO_Logo_200w_padded.png"
border="0" alt="OpenMDAO Home"/>
</a>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../../../index.html">OpenMDAO Documentation v0.8.1</a> &raquo;</li>

          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright none.
      Last updated on Aug 26, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>