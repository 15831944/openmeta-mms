
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Building a Model - Executing a Design of Experiment (DOE) &mdash; OpenMDAO Documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.8.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="OpenMDAO Documentation" href="../../index.html" />
    <link rel="up" title="Simple Optimization" href="index.html" />
    <link rel="next" title="Recording Your Inputs and Outputs" href="case_recorders.html" />
    <link rel="prev" title="Using Scalers and Adders" href="scaler_adder.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="case_recorders.html" title="Recording Your Inputs and Outputs"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="scaler_adder.html" title="Using Scalers and Adders"
             accesskey="P">previous</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../../index.html">OpenMDAO Documentation v0.8.1</a> &raquo;</li>

          <li><a href="../index.html" >OpenMDAO Tutorials</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Simple Optimization</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="building-a-model-executing-a-design-of-experiment-doe">
<span id="doe-paraboloid"></span><span id="index-0"></span><h1>Building a Model - Executing a Design of Experiment (DOE)<a class="headerlink" href="#building-a-model-executing-a-design-of-experiment-doe" title="Permalink to this headline">Â¶</a></h1>
<p>Let&#8217;s say you&#8217;re not interested in optimization, but instead you&#8217;re much more interested
in design space exploration. In that case you would want to use some kind of a Design
Of Experiment (DOE). There are few different kinds of DOEs out there. Some of the most
popular are:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Full Factorial</li>
<li>Random Uniform</li>
<li>Latin Hypercube</li>
<li>Central Composite</li>
</ol>
</div></blockquote>
<p>OpenMDAO provides options to use all of these in our <a class="reference internal" href="../../srcdocs/packages/openmdao.lib.html#openmdao-lib-doegenerators-api"><em>standard library</em></a>. If none of those meet your needs, you can also
write your own DOEgenerator class to expand OpenMDAO capabilities. (We&#8217;ll leave that for a different
tutorial). For now, let&#8217;s assume you wanted to use a Full Factorial DOE, with 10 levels for each
variable. Create a file called <tt class="docutils literal"><span class="pre">doe.py</span></tt> and copy the following into it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openmdao.main.api</span> <span class="kn">import</span> <span class="n">Assembly</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.drivers.api</span> <span class="kn">import</span> <span class="n">DOEdriver</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.doegenerators.api</span> <span class="kn">import</span> <span class="n">FullFactorial</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.casehandlers.api</span> <span class="kn">import</span> <span class="n">ListCaseRecorder</span>

<span class="kn">from</span> <span class="nn">openmdao.examples.simple.paraboloid</span> <span class="kn">import</span> <span class="n">Paraboloid</span>

<span class="k">class</span> <span class="nc">Analysis</span><span class="p">(</span><span class="n">Assembly</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;paraboloid&#39;</span><span class="p">,</span><span class="n">Paraboloid</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;driver&#39;</span><span class="p">,</span><span class="n">DOEdriver</span><span class="p">())</span>
        <span class="c">#There are a number of different kinds of DOE available in openmdao.lib.doegenerators</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">DOEgenerator</span> <span class="o">=</span> <span class="n">FullFactorial</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c">#Full Factorial DOE with 10 levels for each variable</span>

        <span class="c">#DOEdriver will automatically record the values of any parameters for each case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&#39;paraboloid.x&#39;</span><span class="p">,</span><span class="n">low</span><span class="o">=-</span><span class="mi">50</span><span class="p">,</span><span class="n">high</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&#39;paraboloid.y&#39;</span><span class="p">,</span><span class="n">low</span><span class="o">=-</span><span class="mi">50</span><span class="p">,</span><span class="n">high</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="c">#tell the DOEdriver to also record any other variables you want to know for each case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">case_outputs</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;paraboloid.f_xy&#39;</span><span class="p">,]</span>

        <span class="c">#Simple recorder which stores the cases in memory.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recorders</span> <span class="o">=</span> <span class="p">[</span><span class="n">ListCaseRecorder</span><span class="p">(),]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;paraboloid&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Or download our version of the file
<a class="reference download internal" href="../../_downloads/doe.py"><tt class="xref download docutils literal"><span class="pre">here</span></tt></a>.</p>
<p>To run a DOE we use the <a class="reference internal" href="../../srcdocs/packages/openmdao.lib.html#id18"><em>DOEdriver</em></a>, which serves as the
driver any time you want to run any kind of DOE. To specify the particular type of DOE, you set the <tt class="docutils literal"><span class="pre">DOEgenerator</span></tt>
attribute. In this case we used <a class="reference internal" href="../../srcdocs/packages/openmdao.lib.html#fullfactorial-py"><em>FullFactorial</em></a>, but any of the DOEgenerators
would work.</p>
<p>You can see that this code does not look a whole lot different from the code in the previous
tutorials  on <a class="reference internal" href="unconstrained.html#using-conmin"><em>unconstrained</em></a> and <a class="reference internal" href="constrained.html#constrained-optimization"><em>constrained</em></a>
optimizations. We&#8217;re still using  the same Paraboloid component as before. Also, just like before,
we use the <tt class="docutils literal"><span class="pre">add_parameter</span></tt> method to specify what inputs should be varied by the DOE. Since we
specified the low and high to be -50 and 50 respectively,  with 10 levels, the FullFactorial DOE
generator will divide each parameter into 10 evenly spaced bins and then generate the full set of
combinations possible (100 cases in total). Note that a full factorial DOE can get very expensive very quickly.
The total number of cases you run will be <span class="math">\(l^n\)</span>, where <span class="math">\(l\)</span> is the number of levels and <span class="math">\(n\)</span> is the number of
parameters.</p>
<p>One new thing in this example is the use of a case recorder. Each case in a given DOE results in a set of
inputs being set into your model; then the model gets run, and some outputs are calculated. Obviously you
want to record the results of this process for each case in the DOE. You use a <a class="reference internal" href="../../srcdocs/packages/openmdao.lib.html#openmdao-lib-casehandler-api-py"><em>CaseRecorder</em></a> for that.  The CaseRecorder&#8217;s job is to store the information from each
case in some fashion. In this example  we used a <a class="reference internal" href="../../srcdocs/packages/openmdao.lib.html#openmdao-lib-casehandlers-listcase-py"><em>ListCaseRecorder</em></a> which just stored them in memory. There are other kinds though
that are more permanent, for example, the <a class="reference internal" href="../../srcdocs/packages/openmdao.lib.html#openmdao-lib-casehandlers-dbcase-py"><em>DBcaseRecorder</em></a>, which
saves all your cases to a SQLite database to be reviewed later.</p>
<p>All CaseRecorders have the same interface and can be used interchangeably. In fact,
if you notice, we specified a ListCaseRecorder as part of a list.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#Simple recorder which stores the cases in memory.</span>
<span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recorders</span> <span class="o">=</span> <span class="p">[</span><span class="n">ListCaseRecorder</span><span class="p">(),]</span>
</pre></div>
</div>
<p>You can add as many CaseRecorders to that list as you want, and each one will record every case separately. This
enables you to save information to more than one place at the same time.</p>
<p>The last new thing to look at is where we specify some extra variables to be saved off for each case. The DOEdriver
automatically saves all the variables that were specified as parameters in every case. That way, you will always
know exactly what variable values were used for each case. But, of course, the inputs are just half the story. You will
also want to store relevant outputs from each case. This is what the <tt class="docutils literal"><span class="pre">case_outputs</span></tt> attribute is for, on the DOEdriver.
You would put any variables you want to track into this list, but here we have only the one output from
paraboloid.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">case_outputs</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;paraboloid.f_xy&#39;</span><span class="p">,]</span>
</pre></div>
</div>
<p>To run this analysis, you would do the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="kn">import</span> <span class="nn">time</span>

    <span class="n">analysis</span> <span class="o">=</span> <span class="n">Analysis</span><span class="p">()</span>

    <span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="k">print</span> <span class="s">&quot;Elapsed time: &quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">tt</span><span class="p">,</span> <span class="s">&quot;seconds&quot;</span>

    <span class="c">#write the case output to the screen</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recorders</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_iterator</span><span class="p">():</span>
        <span class="k">print</span> <span class="s">&quot;x: </span><span class="si">%f</span><span class="s">, y: </span><span class="si">%f</span><span class="s">, z: </span><span class="si">%f</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;paraboloid.x&#39;</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;paraboloid.y&#39;</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;paraboloid.f_xy&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>The only new stuff here is the bit at the end where we loop over all the cases that were run. To keep
things simple, we just spit out the data to the screen. But the key thing to recognize here is  how you
work with cases. You can loop through each case by calling the <tt class="docutils literal"><span class="pre">get_iterator()</span></tt>  method
on any case recorder. Then for each case you just address the names of the variables like you would
when working with a Python dictionary. You can put the data into any format you want from a loop like
this one.</p>
<p>For instance, here is some code that uses matplotlib to generate a surface plot of the data from this run.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="kn">import</span> <span class="nn">time</span>
    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pylab</span> <span class="k">as</span> <span class="n">p</span>
    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
    <span class="kn">import</span> <span class="nn">mpl_toolkits.mplot3d.axes3d</span> <span class="kn">as</span> <span class="nn">p3</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>

    <span class="n">analysis</span> <span class="o">=</span> <span class="n">Analysis</span><span class="p">()</span>

    <span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="k">print</span> <span class="s">&quot;Elapsed time: &quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">tt</span><span class="p">,</span> <span class="s">&quot;seconds&quot;</span>

    <span class="n">raw_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">X</span><span class="o">=</span><span class="nb">set</span><span class="p">()</span>
    <span class="n">Y</span><span class="o">=</span><span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recorders</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_iterator</span><span class="p">():</span>
        <span class="n">raw_data</span><span class="p">[(</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;paraboloid.x&#39;</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;paraboloid.y&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;paraboloid.f_xy&#39;</span><span class="p">]</span>
        <span class="n">X</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;paraboloid.x&#39;</span><span class="p">])</span>
        <span class="n">Y</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;paraboloid.y&#39;</span><span class="p">])</span>

    <span class="n">X</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span>

    <span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span>
    <span class="n">zi</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">X</span><span class="p">:</span>
        <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">Y</span><span class="p">:</span>
            <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_data</span><span class="p">[(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)])</span>
        <span class="n">zi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="n">zi</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">zi</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">p3</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">,</span><span class="n">zi</span><span class="p">,</span><span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="figure align-center">
<img alt="../../_images/doe.png" src="../../_images/doe.png" />
<p class="caption">A Graph of the Output from the Execution of the DOE</p>
</div>
<p>At times it&#8217;s necessary to rerun an analysis. This can be a problem if the
DOE generator used has a random component. To handle this, DOEdriver records
the normalized DOE values to a CSV file. This file can be read in later by
a <a class="reference internal" href="../../srcdocs/packages/openmdao.lib.html#openmdao-lib-doegenerators-csvfile-py"><em>CSVFile</em></a> DOE generator.
The DOEdriver can then be configured to use this CSVFile generator to rerun
the cases previously generated.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openmdao.main.api</span> <span class="kn">import</span> <span class="n">Assembly</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.drivers.api</span> <span class="kn">import</span> <span class="n">DOEdriver</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.doegenerators.api</span> <span class="kn">import</span> <span class="n">CSVFile</span><span class="p">,</span> <span class="n">Uniform</span>

<span class="kn">from</span> <span class="nn">openmdao.examples.simple.paraboloid</span> <span class="kn">import</span> <span class="n">Paraboloid</span>


<span class="k">class</span> <span class="nc">Analysis</span><span class="p">(</span><span class="n">Assembly</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;paraboloid&#39;</span><span class="p">,</span> <span class="n">Paraboloid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;driver&#39;</span><span class="p">,</span> <span class="n">DOEdriver</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">DOEgenerator</span> <span class="o">=</span> <span class="n">Uniform</span><span class="p">(</span><span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&#39;paraboloid.x&#39;</span><span class="p">,</span> <span class="n">low</span><span class="o">=-</span><span class="mi">50</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&#39;paraboloid.y&#39;</span><span class="p">,</span> <span class="n">low</span><span class="o">=-</span><span class="mi">50</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">case_outputs</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;paraboloid.f_xy&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;paraboloid&#39;</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="n">analysis</span> <span class="o">=</span> <span class="n">Analysis</span><span class="p">()</span>

    <span class="c"># Run original analysis.</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="c"># Reconfigure driver to rerun previously generated cases.</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">DOEgenerator</span> <span class="o">=</span> <span class="n">CSVFile</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">doe_filename</span><span class="p">)</span>
    <span class="c"># Note that analysis.driver.doe_filename will give you the name of</span>
    <span class="c">#   the csv file saved by the DOE driver.</span>

    <span class="c"># No need to re-record cases (and it avoids overwriting them).</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">record_doe</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c"># Rerun analysis.</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Re-running the full experiment is often not of interest. Instead, only certain
cases need to be rerun. OpenMDAO provides case filters to select cases, and
DOEdriver&#8217;s <tt class="docutils literal"><span class="pre">case_filter</span></tt> attribute is used to configure what filter to use.
Note that filters are applied <em>after</em> the normalized parameter values have
been converted to actual values.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openmdao.main.api</span> <span class="kn">import</span> <span class="n">Assembly</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.drivers.api</span> <span class="kn">import</span> <span class="n">DOEdriver</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.doegenerators.api</span> <span class="kn">import</span> <span class="n">CSVFile</span><span class="p">,</span> <span class="n">Uniform</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.casehandlers.api</span> <span class="kn">import</span> <span class="n">ExprCaseFilter</span><span class="p">,</span> <span class="n">SequenceCaseFilter</span><span class="p">,</span> <span class="n">SliceCaseFilter</span>

<span class="kn">from</span> <span class="nn">openmdao.examples.simple.paraboloid</span> <span class="kn">import</span> <span class="n">Paraboloid</span>


<span class="k">class</span> <span class="nc">Analysis</span><span class="p">(</span><span class="n">Assembly</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;paraboloid&#39;</span><span class="p">,</span> <span class="n">Paraboloid</span><span class="p">())</span>
        <span class="n">doe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;driver&#39;</span><span class="p">,</span> <span class="n">DOEdriver</span><span class="p">())</span>
        <span class="n">doe</span><span class="o">.</span><span class="n">DOEgenerator</span> <span class="o">=</span> <span class="n">Uniform</span><span class="p">(</span><span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">doe</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&#39;paraboloid.x&#39;</span><span class="p">,</span> <span class="n">low</span><span class="o">=-</span><span class="mi">50</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">doe</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&#39;paraboloid.y&#39;</span><span class="p">,</span> <span class="n">low</span><span class="o">=-</span><span class="mi">50</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">doe</span><span class="o">.</span><span class="n">case_outputs</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;paraboloid.f_xy&#39;</span><span class="p">]</span>
        <span class="n">doe</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;paraboloid&#39;</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="n">analysis</span> <span class="o">=</span> <span class="n">Analysis</span><span class="p">()</span>
    <span class="n">doe</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">driver</span>

    <span class="c"># Run full experiment.</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="c"># Don&#39;t record reruns.</span>
    <span class="n">doe</span><span class="o">.</span><span class="n">record_doe</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c"># Rerun just 5th and 7th cases.</span>
    <span class="n">doe</span><span class="o">.</span><span class="n">DOEgenerator</span> <span class="o">=</span> <span class="n">CSVFile</span><span class="p">(</span><span class="s">&#39;driver.csv&#39;</span><span class="p">)</span>
    <span class="n">doe</span><span class="o">.</span><span class="n">case_filter</span> <span class="o">=</span> <span class="n">SequenceCaseFilter</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="c"># Rerun every third case starting at 100 through case 200.</span>
    <span class="n">doe</span><span class="o">.</span><span class="n">DOEgenerator</span> <span class="o">=</span> <span class="n">CSVFile</span><span class="p">(</span><span class="s">&#39;driver.csv&#39;</span><span class="p">)</span>
    <span class="n">doe</span><span class="o">.</span><span class="n">case_filter</span> <span class="o">=</span> <span class="n">SliceCaseFilter</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="c"># Rerun every case where x &gt; 0 and y &lt; 0.</span>
    <span class="n">doe</span><span class="o">.</span><span class="n">DOEgenerator</span> <span class="o">=</span> <span class="n">CSVFile</span><span class="p">(</span><span class="s">&#39;driver.csv&#39;</span><span class="p">)</span>
    <span class="n">doe</span><span class="o">.</span><span class="n">case_filter</span> <span class="o">=</span> <span class="n">ExprCaseFilter</span><span class="p">(</span><span class="s">&quot;case[&#39;paraboloid.x&#39;] &gt; 0 and case[&#39;paraboloid.y&#39;] &lt; 0&quot;</span><span class="p">)</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>In the above example we were able to filter cases on input values, or their
location in the sequence of cases run. If instead you need to rerun cases
based on output values, or if they failed, the filtering has to be applied to
cases after they have been run.
<a class="reference internal" href="../../srcdocs/packages/openmdao.lib.html#id13"><em>CaseIteratorDriver</em></a> is a driver which will run an
arbitrary set of cases given to it, such as those recorded by DOEdriver.
CaseIteratorDriver has a <tt class="docutils literal"><span class="pre">filter</span></tt> attribute that can be used in the same
way we used filters with DOEdriver above, but now the filter can operate on
outputs as well as inputs.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openmdao.main.api</span> <span class="kn">import</span> <span class="n">Assembly</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.drivers.api</span> <span class="kn">import</span> <span class="n">CaseIteratorDriver</span><span class="p">,</span> <span class="n">DOEdriver</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.doegenerators.api</span> <span class="kn">import</span> <span class="n">Uniform</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.casehandlers.api</span> <span class="kn">import</span> <span class="n">ListCaseRecorder</span><span class="p">,</span> <span class="n">ListCaseIterator</span><span class="p">,</span> <span class="n">ExprCaseFilter</span>

<span class="kn">from</span> <span class="nn">openmdao.examples.simple.paraboloid</span> <span class="kn">import</span> <span class="n">Paraboloid</span>


<span class="k">class</span> <span class="nc">Analysis</span><span class="p">(</span><span class="n">Assembly</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;paraboloid&#39;</span><span class="p">,</span> <span class="n">Paraboloid</span><span class="p">())</span>
        <span class="n">doe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;driver&#39;</span><span class="p">,</span> <span class="n">DOEdriver</span><span class="p">())</span>
        <span class="n">doe</span><span class="o">.</span><span class="n">DOEgenerator</span> <span class="o">=</span> <span class="n">Uniform</span><span class="p">(</span><span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">doe</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&#39;paraboloid.x&#39;</span><span class="p">,</span> <span class="n">low</span><span class="o">=-</span><span class="mi">50</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">doe</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&#39;paraboloid.y&#39;</span><span class="p">,</span> <span class="n">low</span><span class="o">=-</span><span class="mi">50</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">doe</span><span class="o">.</span><span class="n">case_outputs</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;paraboloid.f_xy&#39;</span><span class="p">]</span>
        <span class="n">doe</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;paraboloid&#39;</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="n">analysis</span> <span class="o">=</span> <span class="n">Analysis</span><span class="p">()</span>

    <span class="c"># Run full experiment and record results.</span>
    <span class="n">recorder</span> <span class="o">=</span> <span class="n">ListCaseRecorder</span><span class="p">()</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recorders</span> <span class="o">=</span> <span class="p">[</span><span class="n">recorder</span><span class="p">]</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="c"># Reconfigure driver.</span>
    <span class="n">workflow</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">workflow</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;driver&#39;</span><span class="p">,</span> <span class="n">CaseIteratorDriver</span><span class="p">())</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">workflow</span>

    <span class="c"># Rerun cases where paraboloid.f_xy &lt;= 0.</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">iterator</span> <span class="o">=</span> <span class="n">recorder</span><span class="o">.</span><span class="n">get_iterator</span><span class="p">()</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">ExprCaseFilter</span><span class="p">(</span><span class="s">&quot;case[&#39;paraboloid.f_xy&#39;] &lt;= 0&quot;</span><span class="p">)</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="c"># Rerun cases which failed.</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">iterator</span> <span class="o">=</span> <span class="n">recorder</span><span class="o">.</span><span class="n">get_iterator</span><span class="p">()</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">ExprCaseFilter</span><span class="p">(</span><span class="s">&quot;case.msg&quot;</span><span class="p">)</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<a href="http://openmdao.org">
 <img src="../../_static/OpenMDAO_Logo_200w_padded.png"
border="0" alt="OpenMDAO Home"/>
</a>

  <h4>Previous topic</h4>
  <p class="topless"><a href="scaler_adder.html"
                        title="previous chapter">Using Scalers and Adders</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="case_recorders.html"
                        title="next chapter">Recording Your Inputs and Outputs</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/tutorials/optimization/doe.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="case_recorders.html" title="Recording Your Inputs and Outputs"
             >next</a> |</li>
        <li class="right" >
          <a href="scaler_adder.html" title="Using Scalers and Adders"
             >previous</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../../index.html">OpenMDAO Documentation v0.8.1</a> &raquo;</li>

          <li><a href="../index.html" >OpenMDAO Tutorials</a> &raquo;</li>
          <li><a href="index.html" >Simple Optimization</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright none.
      Last updated on Aug 26, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>