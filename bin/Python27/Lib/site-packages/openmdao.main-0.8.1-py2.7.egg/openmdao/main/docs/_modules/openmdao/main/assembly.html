
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>openmdao.main.assembly &mdash; OpenMDAO Documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.8.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="OpenMDAO Documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../../../index.html">OpenMDAO Documentation v0.8.1</a> &raquo;</li>

          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for openmdao.main.assembly</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot; Class definition for Assembly. &quot;&quot;&quot;</span>


<span class="c">#public symbols</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Assembly&#39;</span><span class="p">,</span> <span class="s">&#39;set_as_top&#39;</span><span class="p">]</span>

<span class="kn">import</span> <span class="nn">cStringIO</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">implementedBy</span>

<span class="c"># pylint: disable-msg=E0611,F0401</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="kn">as</span> <span class="nn">nx</span>

<span class="kn">from</span> <span class="nn">openmdao.main.interfaces</span> <span class="kn">import</span> <span class="n">implements</span><span class="p">,</span> <span class="n">IAssembly</span><span class="p">,</span> <span class="n">IDriver</span><span class="p">,</span> <span class="n">IArchitecture</span><span class="p">,</span> <span class="n">IComponent</span><span class="p">,</span> <span class="n">IContainer</span><span class="p">,</span>\
                                     <span class="n">ICaseIterator</span><span class="p">,</span> <span class="n">ICaseRecorder</span><span class="p">,</span> <span class="n">IDOEgenerator</span>
<span class="kn">from</span> <span class="nn">openmdao.main.mp_support</span> <span class="kn">import</span> <span class="n">has_interface</span>
<span class="kn">from</span> <span class="nn">openmdao.main.container</span> <span class="kn">import</span> <span class="n">_copydict</span>
<span class="kn">from</span> <span class="nn">openmdao.main.component</span> <span class="kn">import</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Container</span>
<span class="kn">from</span> <span class="nn">openmdao.main.variable</span> <span class="kn">import</span> <span class="n">Variable</span>
<span class="kn">from</span> <span class="nn">openmdao.main.vartree</span> <span class="kn">import</span> <span class="n">VariableTree</span>
<span class="kn">from</span> <span class="nn">openmdao.main.datatypes.api</span> <span class="kn">import</span> <span class="n">Slot</span>
<span class="kn">from</span> <span class="nn">openmdao.main.driver</span> <span class="kn">import</span> <span class="n">Driver</span><span class="p">,</span> <span class="n">Run_Once</span>
<span class="kn">from</span> <span class="nn">openmdao.main.hasparameters</span> <span class="kn">import</span> <span class="n">HasParameters</span><span class="p">,</span> <span class="n">ParameterGroup</span>
<span class="kn">from</span> <span class="nn">openmdao.main.hasconstraints</span> <span class="kn">import</span> <span class="n">HasConstraints</span><span class="p">,</span> <span class="n">HasEqConstraints</span><span class="p">,</span> <span class="n">HasIneqConstraints</span>
<span class="kn">from</span> <span class="nn">openmdao.main.hasobjective</span> <span class="kn">import</span> <span class="n">HasObjective</span><span class="p">,</span> <span class="n">HasObjectives</span>
<span class="kn">from</span> <span class="nn">openmdao.main.rbac</span> <span class="kn">import</span> <span class="n">rbac</span>
<span class="kn">from</span> <span class="nn">openmdao.main.mp_support</span> <span class="kn">import</span> <span class="n">is_instance</span>
<span class="kn">from</span> <span class="nn">openmdao.main.expreval</span> <span class="kn">import</span> <span class="n">ConnectedExprEvaluator</span>
<span class="kn">from</span> <span class="nn">openmdao.main.printexpr</span> <span class="kn">import</span> <span class="n">eliminate_expr_ws</span>
<span class="kn">from</span> <span class="nn">openmdao.util.nameutil</span> <span class="kn">import</span> <span class="n">partition_names_by_comp</span>

<span class="n">_iodict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;out&#39;</span><span class="p">:</span> <span class="s">&#39;output&#39;</span><span class="p">,</span> <span class="s">&#39;in&#39;</span><span class="p">:</span> <span class="s">&#39;input&#39;</span><span class="p">}</span>


<span class="n">__has_top__</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">__toplock__</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>


<div class="viewcode-block" id="set_as_top"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.set_as_top">[docs]</a><span class="k">def</span> <span class="nf">set_as_top</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="n">first_only</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Specifies that the given Container is the top of a Container hierarchy.</span>
<span class="sd">    If first_only is True, then only set it as a top if a global</span>
<span class="sd">    top doesn&#39;t already exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">__toplock__</span>
    <span class="k">global</span> <span class="n">__has_top__</span>
    <span class="k">with</span> <span class="n">__toplock__</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">__has_top__</span> <span class="ow">is</span> <span class="bp">False</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="n">Assembly</span><span class="p">):</span>
            <span class="n">__has_top__</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">first_only</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cont</span>
    <span class="k">if</span> <span class="n">cont</span><span class="o">.</span><span class="n">_call_cpath_updated</span><span class="p">:</span>
        <span class="n">cont</span><span class="o">.</span><span class="n">cpath_updated</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">cont</span>

</div>
<span class="k">class</span> <span class="nc">PassthroughTrait</span><span class="p">(</span><span class="n">Variable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A trait that can use another trait for validation, but otherwise is</span>
<span class="sd">    just a trait that lives on an Assembly boundary and can be connected</span>
<span class="sd">    to other traits within the Assembly.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validation for the PassThroughTrait.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_trait</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_trait</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>


<span class="k">class</span> <span class="nc">PassthroughProperty</span><span class="p">(</span><span class="n">Variable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Replacement for PassthroughTrait when the target is a proxy/property</span>
<span class="sd">    trait. PassthroughTrait would get a core dump while pickling.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_trait</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trait</span> <span class="o">=</span> <span class="n">target_trait</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vals</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PassthroughProperty</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">metadata</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trait</span><span class="o">.</span><span class="n">default_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vals</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vals</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vals</span><span class="p">[</span><span class="n">obj</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trait</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ExprMapper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A mapping between source expressions and destination expressions&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exprgraph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>  <span class="c"># graph of source expressions to destination expressions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope</span> <span class="o">=</span> <span class="n">scope</span>

    <span class="k">def</span> <span class="nf">get_output_exprs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return all destination expressions at the output boundary&quot;&quot;&quot;</span>
        <span class="n">exprs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprgraph</span>
        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">graph</span><span class="o">.</span><span class="n">in_degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;expr&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">get_referenced_compnames</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">exprs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">exprs</span>

    <span class="k">def</span> <span class="nf">get_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprgraph</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">node</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">node</span><span class="p">[</span><span class="s">&#39;expr&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">list_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_passthrough</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of tuples of the form (outvarname, invarname).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">excludes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprgraph</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;expr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">refs_parent</span><span class="p">()])</span>
        <span class="k">if</span> <span class="n">show_passthrough</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprgraph</span><span class="o">.</span><span class="n">edges</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">u</span> <span class="ow">in</span> <span class="n">excludes</span> <span class="ow">or</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">excludes</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprgraph</span><span class="o">.</span><span class="n">edges</span><span class="p">()</span>
                       <span class="k">if</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">u</span> <span class="ow">and</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">v</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">u</span> <span class="ow">in</span> <span class="n">excludes</span> <span class="ow">or</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">excludes</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">get_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest_expr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the text of the source expression that is connected to the given</span>
<span class="sd">        destination expression.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprgraph</span><span class="o">.</span><span class="n">pred</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dest_expr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dct</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dct</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">get_dests</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_expr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the list of destination expressions that are connected to the given</span>
<span class="sd">        source expression.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprgraph</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">graph</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">name</span><span class="p">)[</span><span class="s">&#39;expr&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprgraph</span><span class="o">.</span><span class="n">succ</span><span class="p">[</span><span class="n">src_expr</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>

    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove any connections referring to the given component.&quot;&quot;&quot;</span>
        <span class="n">refs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_referring_exprs</span><span class="p">(</span><span class="n">compname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">refs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exprgraph</span><span class="o">.</span><span class="n">remove_nodes_from</span><span class="p">(</span><span class="n">refs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_disconnected_exprs</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">srcexpr</span><span class="p">,</span> <span class="n">destexpr</span><span class="p">,</span> <span class="n">scope</span><span class="p">):</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">srcexpr</span><span class="o">.</span><span class="n">text</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="n">destexpr</span><span class="o">.</span><span class="n">text</span>
        <span class="n">srcvars</span> <span class="o">=</span> <span class="n">srcexpr</span><span class="o">.</span><span class="n">get_referenced_varpaths</span><span class="p">(</span><span class="n">copy</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">destvar</span> <span class="o">=</span> <span class="n">destexpr</span><span class="o">.</span><span class="n">get_referenced_varpaths</span><span class="p">()</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="n">destcompname</span><span class="p">,</span> <span class="n">destcomp</span><span class="p">,</span> <span class="n">destvarname</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_split_varpath</span><span class="p">(</span><span class="n">destvar</span><span class="p">)</span>
        <span class="n">desttrait</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">destvar</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;parent.&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">srcvar</span> <span class="ow">in</span> <span class="n">srcvars</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">srcvar</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;parent.&#39;</span><span class="p">):</span>
                    <span class="n">srccompname</span><span class="p">,</span> <span class="n">srccomp</span><span class="p">,</span> <span class="n">srcvarname</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_split_varpath</span><span class="p">(</span><span class="n">srcvar</span><span class="p">)</span>
                    <span class="n">src_io</span> <span class="o">=</span> <span class="s">&#39;in&#39;</span> <span class="k">if</span> <span class="n">srccomp</span> <span class="ow">is</span> <span class="n">scope</span> <span class="k">else</span> <span class="s">&#39;out&#39;</span>
                    <span class="n">srctrait</span> <span class="o">=</span> <span class="n">srccomp</span><span class="o">.</span><span class="n">get_dyn_trait</span><span class="p">(</span><span class="n">srcvarname</span><span class="p">,</span> <span class="n">src_io</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">desttrait</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">dest_io</span> <span class="o">=</span> <span class="s">&#39;out&#39;</span> <span class="k">if</span> <span class="n">destcomp</span> <span class="ow">is</span> <span class="n">scope</span> <span class="k">else</span> <span class="s">&#39;in&#39;</span>
                        <span class="n">desttrait</span> <span class="o">=</span> <span class="n">destcomp</span><span class="o">.</span><span class="n">get_dyn_trait</span><span class="p">(</span><span class="n">destvarname</span><span class="p">,</span> <span class="n">dest_io</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">srcexpr</span><span class="o">.</span><span class="n">refs_parent</span><span class="p">()</span> <span class="ow">and</span> <span class="n">desttrait</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># punt if dest is not just a simple var name.</span>
                <span class="c"># validity will still be checked at execution time</span>
                <span class="k">if</span> <span class="n">destvar</span> <span class="o">==</span> <span class="n">destexpr</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="n">ttype</span> <span class="o">=</span> <span class="n">desttrait</span><span class="o">.</span><span class="n">trait_type</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">ttype</span><span class="p">:</span>
                        <span class="n">ttype</span> <span class="o">=</span> <span class="n">desttrait</span>
                    <span class="n">srcval</span> <span class="o">=</span> <span class="n">srcexpr</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">ttype</span><span class="o">.</span><span class="n">validate</span><span class="p">:</span>
                        <span class="n">ttype</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">destcomp</span><span class="p">,</span> <span class="n">destvarname</span><span class="p">,</span> <span class="n">srcval</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c"># no validate function on destination trait. Most likely</span>
                        <span class="c"># it&#39;s a property trait.  No way to validate without</span>
                        <span class="c"># unknown side effects. Have to wait until later when</span>
                        <span class="c"># data actually gets passed via the connection.</span>
                        <span class="k">pass</span>

        <span class="k">if</span> <span class="n">src</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprgraph</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exprgraph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="n">srcexpr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dest</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprgraph</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exprgraph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="n">destexpr</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_exprgraph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">find_referring_exprs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of expression strings that reference the given name, which</span>
<span class="sd">        can refer to either a variable or a component.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">node</span> <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprgraph</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;expr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">refers_to</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">_remove_disconnected_exprs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># remove all expressions that are no longer connected to anything</span>
        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprgraph</span>
        <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">graph</span><span class="o">.</span><span class="n">in_degree</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">graph</span><span class="o">.</span><span class="n">out_degree</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">srcpath</span><span class="p">,</span> <span class="n">destpath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Disconnect the given expressions/variables/components.&quot;&quot;&quot;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprgraph</span>

        <span class="k">if</span> <span class="n">destpath</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">srcpath</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">srcpath</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">remove_nodes_from</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_referring_exprs</span><span class="p">(</span><span class="n">srcpath</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_disconnected_exprs</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">srcpath</span> <span class="ow">in</span> <span class="n">graph</span> <span class="ow">and</span> <span class="n">destpath</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">srcpath</span><span class="p">,</span> <span class="n">destpath</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_disconnected_exprs</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c"># assume they&#39;re disconnecting two variables, so find connected exprs that refer to them</span>
            <span class="n">src_exprs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_referring_exprs</span><span class="p">(</span><span class="n">srcpath</span><span class="p">))</span>
            <span class="n">dest_exprs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_referring_exprs</span><span class="p">(</span><span class="n">destpath</span><span class="p">))</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">([(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span> <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dest</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">()</span>
                                           <span class="k">if</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">src_exprs</span> <span class="ow">and</span> <span class="n">dest</span> <span class="ow">in</span> <span class="n">dest_exprs</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">check_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">scope</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check validity of connecting a source expression to a destination expression.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_source</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">scope</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39; is already connected to source &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_source</span><span class="p">(</span><span class="n">dest</span><span class="p">)),</span>
                                  <span class="ne">RuntimeError</span><span class="p">)</span>

        <span class="n">destexpr</span> <span class="o">=</span> <span class="n">ConnectedExprEvaluator</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">getter</span><span class="o">=</span><span class="s">&#39;get_wrapped_attr&#39;</span><span class="p">,</span>
                                          <span class="n">is_dest</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">srcexpr</span> <span class="o">=</span> <span class="n">ConnectedExprEvaluator</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">getter</span><span class="o">=</span><span class="s">&#39;get_wrapped_attr&#39;</span><span class="p">)</span>

        <span class="n">srccomps</span> <span class="o">=</span> <span class="n">srcexpr</span><span class="o">.</span><span class="n">get_referenced_compnames</span><span class="p">()</span>
        <span class="n">destcomps</span> <span class="o">=</span> <span class="n">destexpr</span><span class="o">.</span><span class="n">get_referenced_compnames</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">destcomps</span> <span class="ow">and</span> <span class="n">destcomps</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="ow">in</span> <span class="n">srccomps</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39; and &#39;</span><span class="si">%s</span><span class="s">&#39; refer to the same component.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">srcexpr</span><span class="p">,</span> <span class="n">destexpr</span>


<span class="k">def</span> <span class="nf">_find_common_interface</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">iface</span> <span class="ow">in</span> <span class="p">(</span><span class="n">IAssembly</span><span class="p">,</span> <span class="n">IComponent</span><span class="p">,</span> <span class="n">IDriver</span><span class="p">,</span> <span class="n">IArchitecture</span><span class="p">,</span> <span class="n">IContainer</span><span class="p">,</span>
                  <span class="n">ICaseIterator</span><span class="p">,</span> <span class="n">ICaseRecorder</span><span class="p">,</span> <span class="n">IDOEgenerator</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">has_interface</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="n">iface</span><span class="p">)</span> <span class="ow">and</span> <span class="n">has_interface</span><span class="p">(</span><span class="n">obj2</span><span class="p">,</span> <span class="n">iface</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">iface</span>
    <span class="k">return</span> <span class="bp">None</span>


<div class="viewcode-block" id="Assembly"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly">[docs]</a><span class="k">class</span> <span class="nc">Assembly</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is a container of Components. It understands how to connect inputs</span>
<span class="sd">    and outputs between its children.  When executed, it runs the top level</span>
<span class="sd">    Driver called &#39;driver&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">implements</span><span class="p">(</span><span class="n">IAssembly</span><span class="p">)</span>

    <span class="n">driver</span> <span class="o">=</span> <span class="n">Slot</span><span class="p">(</span><span class="n">IDriver</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                    <span class="n">desc</span><span class="o">=</span><span class="s">&quot;The top level Driver that manages execution of &quot;</span>
                    <span class="s">&quot;this Assembly.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Assembly</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_exprmapper</span> <span class="o">=</span> <span class="n">ExprMapper</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_graph_loops</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># default Driver executes its workflow once</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;driver&#39;</span><span class="p">,</span> <span class="n">Run_Once</span><span class="p">())</span>

        <span class="n">set_as_top</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c"># we&#39;re the top Assembly only if we&#39;re the first instantiated</span>

    <span class="nd">@rbac</span><span class="p">((</span><span class="s">&#39;owner&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">))</span>
<div class="viewcode-block" id="Assembly.set_itername"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.set_itername">[docs]</a>    <span class="k">def</span> <span class="nf">set_itername</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itername</span><span class="p">,</span> <span class="n">seqno</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set current &#39;iteration coordinates&#39;. Overrides :class:`Component`</span>
<span class="sd">        to propagate to driver, and optionally set the initial count in the</span>
<span class="sd">        driver&#39;s workflow. Setting the initial count is typically done by</span>
<span class="sd">        :class:`CaseIterDriverBase` on a remote top level assembly.</span>

<span class="sd">        itername: string</span>
<span class="sd">            Iteration coordinates.</span>

<span class="sd">        seqno: int</span>
<span class="sd">            Initial execution count for driver&#39;s workflow.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Assembly</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_itername</span><span class="p">(</span><span class="n">itername</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">set_itername</span><span class="p">(</span><span class="n">itername</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">seqno</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">set_initial_count</span><span class="p">(</span><span class="n">seqno</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Assembly.add"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call the base class *add*.  Then,</span>
<span class="sd">        if obj is a Component, add it to the component graph.</span>

<span class="sd">        Returns the added object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Assembly</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Component</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_depgraph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>
</div>
<div class="viewcode-block" id="Assembly.find_referring_connections"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.find_referring_connections">[docs]</a>    <span class="k">def</span> <span class="nf">find_referring_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of connections where the given name is referred</span>
<span class="sd">        to either in the source or the destination.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">exprset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_exprmapper</span><span class="o">.</span><span class="n">find_referring_exprs</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_connections</span><span class="p">(</span><span class="n">show_passthrough</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                                                <span class="k">if</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">exprset</span> <span class="ow">or</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">exprset</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Assembly.find_in_workflows"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.find_in_workflows">[docs]</a>    <span class="k">def</span> <span class="nf">find_in_workflows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of tuples of the form (workflow, index) for all</span>
<span class="sd">        workflows in the scope of this Assembly that contain the given</span>
<span class="sd">        component name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wflows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Driver</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">workflow</span><span class="p">:</span>
                <span class="n">wflows</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">obj</span><span class="o">.</span><span class="n">workflow</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">wflows</span>
</div>
    <span class="k">def</span> <span class="nf">_cleanup_autopassthroughs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clean up any autopassthrough connections involving the given name.</span>
<span class="sd">        Returns a list containing a tuple for each removed connection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">old_autos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="n">old_rgx</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;(\W?)</span><span class="si">%s</span><span class="s">.&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">par_rgx</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;(\W?)parent.&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_depgraph</span><span class="o">.</span><span class="n">list_autopassthroughs</span><span class="p">():</span>
                <span class="n">newu</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">old_rgx</span><span class="p">,</span> <span class="s">r&#39;\g&lt;1&gt;</span><span class="si">%s</span><span class="s">.&#39;</span> <span class="o">%</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">]),</span> <span class="n">u</span><span class="p">)</span>
                <span class="n">newv</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">old_rgx</span><span class="p">,</span> <span class="s">r&#39;\g&lt;1&gt;</span><span class="si">%s</span><span class="s">.&#39;</span> <span class="o">%</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">]),</span> <span class="n">v</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">newu</span> <span class="o">!=</span> <span class="n">u</span> <span class="ow">or</span> <span class="n">newv</span> <span class="o">!=</span> <span class="n">v</span><span class="p">:</span>
                    <span class="n">old_autos</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
                    <span class="n">u</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">par_rgx</span><span class="p">,</span> <span class="s">r&#39;\g&lt;1&gt;&#39;</span><span class="p">,</span> <span class="n">newu</span><span class="p">)</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">par_rgx</span><span class="p">,</span> <span class="s">r&#39;\g&lt;1&gt;&#39;</span><span class="p">,</span> <span class="n">newv</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">old_autos</span>

<div class="viewcode-block" id="Assembly.rename"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.rename">[docs]</a>    <span class="k">def</span> <span class="nf">rename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldname</span><span class="p">,</span> <span class="n">newname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Renames a child of this object from oldname to newname.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_rename</span><span class="p">(</span><span class="n">oldname</span><span class="p">,</span> <span class="n">newname</span><span class="p">)</span>
        <span class="n">conns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_referring_connections</span><span class="p">(</span><span class="n">oldname</span><span class="p">)</span>
        <span class="n">wflows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_in_workflows</span><span class="p">(</span><span class="n">oldname</span><span class="p">)</span>
        <span class="n">old_autos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup_autopassthroughs</span><span class="p">(</span><span class="n">oldname</span><span class="p">)</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">oldname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">newname</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>

        <span class="c"># oldname has now been removed from workflows, but newname may be in the wrong</span>
        <span class="c"># location, so force it to be at the same index as before removal</span>
        <span class="k">for</span> <span class="n">wflow</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">wflows</span><span class="p">:</span>
            <span class="n">wflow</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">newname</span><span class="p">)</span>
            <span class="n">wflow</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">newname</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>

        <span class="n">old_rgx</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;(\W?)</span><span class="si">%s</span><span class="s">.&#39;</span> <span class="o">%</span> <span class="n">oldname</span><span class="p">)</span>
        <span class="n">par_rgx</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;(\W?)parent.&#39;</span><span class="p">)</span>

        <span class="c"># recreate all of the broken connections after translating oldname to newname</span>
        <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">conns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">old_rgx</span><span class="p">,</span> <span class="s">r&#39;\g&lt;1&gt;</span><span class="si">%s</span><span class="s">.&#39;</span> <span class="o">%</span> <span class="n">newname</span><span class="p">,</span> <span class="n">u</span><span class="p">),</span>
                         <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">old_rgx</span><span class="p">,</span> <span class="s">r&#39;\g&lt;1&gt;</span><span class="si">%s</span><span class="s">.&#39;</span> <span class="o">%</span> <span class="n">newname</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>

        <span class="c"># recreate autopassthroughs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">old_autos</span><span class="p">:</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">old_rgx</span><span class="p">,</span> <span class="s">r&#39;\g&lt;1&gt;</span><span class="si">%s</span><span class="s">.&#39;</span> <span class="o">%</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">newname</span><span class="p">]),</span> <span class="n">u</span><span class="p">)</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">old_rgx</span><span class="p">,</span> <span class="s">r&#39;\g&lt;1&gt;</span><span class="si">%s</span><span class="s">.&#39;</span> <span class="o">%</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">newname</span><span class="p">]),</span> <span class="n">v</span><span class="p">)</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">par_rgx</span><span class="p">,</span> <span class="s">r&#39;\g&lt;1&gt;&#39;</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">par_rgx</span><span class="p">,</span> <span class="s">r&#39;\g&lt;1&gt;&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Assembly.replace"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.replace">[docs]</a>    <span class="k">def</span> <span class="nf">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_name</span><span class="p">,</span> <span class="n">newobj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Replace one object with another, attempting to mimic the inputs and connections</span>
<span class="sd">        of the replaced object as much as possible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tobj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_name</span><span class="p">)</span>

        <span class="c"># Save existing driver references.</span>
        <span class="n">refs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">has_interface</span><span class="p">(</span><span class="n">tobj</span><span class="p">,</span> <span class="n">IComponent</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">tobj</span> <span class="ow">and</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Driver</span><span class="p">):</span>
                    <span class="n">refs</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_references</span><span class="p">(</span><span class="n">target_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">has_interface</span><span class="p">(</span><span class="n">newobj</span><span class="p">,</span> <span class="n">IComponent</span><span class="p">):</span>  <span class="c"># remove any existing connections to replacement object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">newobj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">newobj</span><span class="p">,</span> <span class="s">&#39;mimic&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">newobj</span><span class="o">.</span><span class="n">mimic</span><span class="p">(</span><span class="n">tobj</span><span class="p">)</span>  <span class="c"># this should copy inputs, delegates and set name</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reraise_exception</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t replace &#39;</span><span class="si">%s</span><span class="s">&#39; of type </span><span class="si">%s</span><span class="s"> with type </span><span class="si">%s</span><span class="s">&quot;</span>
                                       <span class="o">%</span> <span class="p">(</span><span class="n">target_name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">tobj</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                                          <span class="nb">type</span><span class="p">(</span><span class="n">newobj</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">))</span>
        <span class="n">conns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_referring_connections</span><span class="p">(</span><span class="n">target_name</span><span class="p">)</span>
        <span class="n">wflows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_in_workflows</span><span class="p">(</span><span class="n">target_name</span><span class="p">)</span>
        <span class="n">target_rgx</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;(\W?)</span><span class="si">%s</span><span class="s">.&#39;</span> <span class="o">%</span> <span class="n">target_name</span><span class="p">)</span>
        <span class="n">conns</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_depgraph</span><span class="o">.</span><span class="n">list_autopassthroughs</span><span class="p">()</span> <span class="k">if</span>
                                 <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">target_rgx</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span>
                                 <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">target_rgx</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">target_name</span><span class="p">,</span> <span class="n">newobj</span><span class="p">)</span>  <span class="c"># this will remove the old object (and any connections to it)</span>

        <span class="c"># recreate old connections</span>
        <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">conns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="c"># add new object (if it&#39;s a Component) to any workflows where target was</span>
        <span class="k">if</span> <span class="n">has_interface</span><span class="p">(</span><span class="n">newobj</span><span class="p">,</span> <span class="n">IComponent</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">wflow</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">wflows</span><span class="p">:</span>
                <span class="n">wflow</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">target_name</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>

        <span class="c"># Restore driver references.</span>
        <span class="k">if</span> <span class="n">refs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">newobj</span> <span class="ow">and</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Driver</span><span class="p">):</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">restore_references</span><span class="p">(</span><span class="n">refs</span><span class="p">[</span><span class="n">obj</span><span class="p">],</span> <span class="n">target_name</span><span class="p">)</span>

        <span class="c"># Workflows need a reference to their new parent driver</span>
        <span class="k">if</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">newobj</span><span class="p">,</span> <span class="n">Driver</span><span class="p">):</span>
            <span class="n">newobj</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">newobj</span>
</div>
<div class="viewcode-block" id="Assembly.remove"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove the named container object from this assembly and remove</span>
<span class="sd">        it from its workflow(s) if it&#39;s a Component.&quot;&quot;&quot;</span>
        <span class="n">cont</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exprmapper</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">has_interface</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="n">IComponent</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_depgraph</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">cont</span> <span class="ow">and</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Driver</span><span class="p">):</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">remove_references</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Assembly</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Assembly.create_passthrough"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.create_passthrough">[docs]</a>    <span class="k">def</span> <span class="nf">create_passthrough</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathname</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a PassthroughTrait that uses the trait indicated by</span>
<span class="sd">        pathname for validation, adds it to self, and creates a connection</span>
<span class="sd">        between the two. If alias is *None,* the name of the alias trait will</span>
<span class="sd">        be the last entry in its pathname. The trait specified by pathname</span>
<span class="sd">        must exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">pathname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">alias</span><span class="p">:</span>
            <span class="n">newname</span> <span class="o">=</span> <span class="n">alias</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newname</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">newname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39; already exists&quot;</span> <span class="o">%</span>
                                 <span class="n">newname</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&#39;destination of passthrough must be a dotted path&#39;</span><span class="p">,</span>
                                 <span class="ne">NameError</span><span class="p">)</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">comp</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">part</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">trait</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trait</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get_trait</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">iotype</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get_iotype</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">trait</span><span class="p">:</span>
            <span class="n">ttype</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">trait_type</span>
            <span class="k">if</span> <span class="n">ttype</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">ttype</span> <span class="o">=</span> <span class="n">trait</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">pathname</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;the variable named &#39;</span><span class="si">%s</span><span class="s">&#39; can&#39;t be found&quot;</span> <span class="o">%</span>
                                     <span class="n">pathname</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span>
            <span class="n">iotype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span> <span class="s">&#39;iotype&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">trait</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">trait</span><span class="o">.</span><span class="n">validate</span><span class="p">:</span>
            <span class="n">trait</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c"># no validate function, so just don&#39;t use trait for validation</span>

        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="n">pathname</span><span class="p">)</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pathname</span>
        <span class="c"># PassthroughTrait to a trait with get/set methods causes a core dump</span>
        <span class="c"># in Traits (at least through 3.6) while pickling.</span>
        <span class="k">if</span> <span class="s">&quot;validation_trait&quot;</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">metadata</span><span class="p">[</span><span class="s">&#39;validation_trait&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">newtrait</span> <span class="o">=</span> <span class="n">PassthroughTrait</span><span class="p">(</span><span class="o">**</span><span class="n">metadata</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newtrait</span> <span class="o">=</span> <span class="n">PassthroughProperty</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s">&#39;validation_trait&#39;</span><span class="p">],</span>
                                               <span class="o">**</span><span class="n">metadata</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">trait</span> <span class="ow">and</span> <span class="n">ttype</span><span class="o">.</span><span class="n">get</span><span class="p">:</span>
            <span class="n">newtrait</span> <span class="o">=</span> <span class="n">PassthroughProperty</span><span class="p">(</span><span class="n">ttype</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newtrait</span> <span class="o">=</span> <span class="n">PassthroughTrait</span><span class="p">(</span><span class="n">validation_trait</span><span class="o">=</span><span class="n">trait</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span><span class="n">newname</span><span class="p">,</span> <span class="n">newtrait</span><span class="p">)</span>

        <span class="c"># Copy trait value according to &#39;copy&#39; attribute in the trait</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pathname</span><span class="p">)</span>

        <span class="n">ttype</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">trait_type</span>
        <span class="k">if</span> <span class="n">ttype</span><span class="o">.</span><span class="n">copy</span><span class="p">:</span>
            <span class="c"># Variable trees need to point to a new parent.</span>
            <span class="c"># Also, let&#39;s not deepcopy the outside universe</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Container</span><span class="p">):</span>
                <span class="n">old_parent</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">parent</span>
                <span class="n">val</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">val_copy</span> <span class="o">=</span> <span class="n">_copydict</span><span class="p">[</span><span class="n">ttype</span><span class="o">.</span><span class="n">copy</span><span class="p">](</span><span class="n">val</span><span class="p">)</span>
                <span class="n">val</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">old_parent</span>
                <span class="n">val_copy</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">val_copy</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">_copydict</span><span class="p">[</span><span class="n">ttype</span><span class="o">.</span><span class="n">copy</span><span class="p">](</span><span class="n">val</span><span class="p">)</span>

        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newname</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">iotype</span> <span class="o">==</span> <span class="s">&#39;in&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">newname</span><span class="p">,</span> <span class="n">pathname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span> <span class="n">newname</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">newname</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">err</span>

        <span class="k">return</span> <span class="n">newtrait</span>
</div>
<div class="viewcode-block" id="Assembly.get_passthroughs"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.get_passthroughs">[docs]</a>    <span class="k">def</span> <span class="nf">get_passthroughs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Get all the inputs and outputs of the assembly&#39;s child components</span>
<span class="sd">            and indicate for each whether or not it is a passthrough variable.</span>
<span class="sd">            If it is a passthrough, provide the assembly&#39;s name for the variable.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">passthroughs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_inputs</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">():</span>
            <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;target&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">passthroughs</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_components</span><span class="p">():</span>
            <span class="n">inputs</span><span class="p">[</span><span class="n">comp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">input_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span><span class="o">.</span><span class="n">list_inputs</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">input_vars</span><span class="p">:</span>
                <span class="n">var_path</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">comp</span><span class="p">,</span> <span class="n">var_name</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">var_path</span> <span class="ow">in</span> <span class="n">passthroughs</span><span class="p">:</span>
                    <span class="n">inputs</span><span class="p">[</span><span class="n">comp</span><span class="p">][</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">passthroughs</span><span class="p">[</span><span class="n">var_path</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">inputs</span><span class="p">[</span><span class="n">comp</span><span class="p">][</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="n">outputs</span><span class="p">[</span><span class="n">comp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">output_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">output_vars</span><span class="p">:</span>
                <span class="n">var_path</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">comp</span><span class="p">,</span> <span class="n">var_name</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">var_path</span> <span class="ow">in</span> <span class="n">passthroughs</span><span class="p">:</span>
                    <span class="n">outputs</span><span class="p">[</span><span class="n">comp</span><span class="p">][</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">passthroughs</span><span class="p">[</span><span class="n">var_path</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">outputs</span><span class="p">[</span><span class="n">comp</span><span class="p">][</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s">&#39;inputs&#39;</span><span class="p">:</span> <span class="n">inputs</span><span class="p">,</span>
            <span class="s">&#39;outputs&#39;</span><span class="p">:</span> <span class="n">outputs</span>
        <span class="p">}</span>
</div>
    <span class="k">def</span> <span class="nf">_split_varpath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a tuple of compname,component,varname given a path</span>
<span class="sd">        name of the form &#39;compname.varname&#39;. If the name is of the form &#39;varname&#39;,</span>
<span class="sd">        then compname will be None and comp is self.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">compname</span><span class="p">,</span> <span class="n">varname</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trait</span><span class="p">(</span><span class="n">compname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">iotype</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">compname</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compname</span><span class="p">),</span> <span class="n">varname</span><span class="p">)</span>

    <span class="nd">@rbac</span><span class="p">((</span><span class="s">&#39;owner&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">))</span>
<div class="viewcode-block" id="Assembly.connect"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Connect one src expression to one destination expression. This could be</span>
<span class="sd">        a normal connection between variables from two internal Components, or</span>
<span class="sd">        it could be a passthrough connection, which connects across the scope boundary</span>
<span class="sd">        of this object.  When a pathname begins with &#39;parent.&#39;, that indicates</span>
<span class="sd">        it is referring to a Variable outside of this object&#39;s scope.</span>

<span class="sd">        src: str</span>
<span class="sd">            Source expression string.</span>

<span class="sd">        dest: str or list(str)</span>
<span class="sd">            Destination expression string(s).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">eliminate_expr_ws</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">dest</span> <span class="o">=</span> <span class="p">(</span><span class="n">dest</span><span class="p">,)</span>
        <span class="k">for</span> <span class="n">dst</span> <span class="ow">in</span> <span class="n">dest</span><span class="p">:</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="n">eliminate_expr_ws</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connect</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handle one connection destination. This should only be called via the connect()</span>
<span class="sd">        function, never directly.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Among other things, check if already connected.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">srcexpr</span><span class="p">,</span> <span class="n">destexpr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprmapper</span><span class="o">.</span><span class="n">check_connect</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;Can&#39;t connect &#39;</span><span class="si">%s</span><span class="s">&#39; to &#39;</span><span class="si">%s</span><span class="s">&#39;: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)),</span>
                                 <span class="ne">RuntimeError</span><span class="p">)</span>

        <span class="c"># Check if src is declared as a parameter in any driver in the assembly</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_containers</span><span class="p">():</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">Driver</span><span class="p">)</span> <span class="ow">and</span> \
               <span class="nb">hasattr</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="s">&#39;list_param_targets&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">dest</span> <span class="ow">in</span> <span class="n">comp</span><span class="o">.</span><span class="n">list_param_targets</span><span class="p">():</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Can&#39;t connect &#39;</span><span class="si">%s</span><span class="s">&#39; to &#39;</span><span class="si">%s</span><span class="s">&#39; &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;because the target is a Parameter in &quot;</span> <span class="o">+</span> \
                           <span class="s">&quot;driver &#39;</span><span class="si">%s</span><span class="s">&#39;.&quot;</span> <span class="o">%</span> <span class="n">comp</span><span class="o">.</span><span class="n">name</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">RuntimeError</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Assembly</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exprmapper</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">srcexpr</span><span class="p">,</span> <span class="n">destexpr</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Assembly</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;Can&#39;t connect &#39;</span><span class="si">%s</span><span class="s">&#39; to &#39;</span><span class="si">%s</span><span class="s">&#39;: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)),</span>
                                 <span class="ne">RuntimeError</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">srcexpr</span><span class="o">.</span><span class="n">refs_parent</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">destexpr</span><span class="o">.</span><span class="n">refs_parent</span><span class="p">():</span>
                <span class="c"># if it&#39;s an internal connection, could change dependencies, so we have</span>
                <span class="c"># to call config_changed to notify our driver</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config_changed</span><span class="p">(</span><span class="n">update_parent</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

                <span class="n">destcompname</span><span class="p">,</span> <span class="n">destcomp</span><span class="p">,</span> <span class="n">destvarname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_varpath</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>

                <span class="n">outs</span> <span class="o">=</span> <span class="n">destcomp</span><span class="o">.</span><span class="n">invalidate_deps</span><span class="p">(</span><span class="n">varnames</span><span class="o">=</span><span class="nb">set</span><span class="p">([</span><span class="n">destvarname</span><span class="p">]),</span> <span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">outs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">outs</span><span class="p">:</span>
                    <span class="n">bouts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">child_invalidated</span><span class="p">(</span><span class="n">destcompname</span><span class="p">,</span> <span class="n">outs</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="nd">@rbac</span><span class="p">((</span><span class="s">&#39;owner&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">))</span>
<div class="viewcode-block" id="Assembly.disconnect"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.disconnect">[docs]</a>    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varpath</span><span class="p">,</span> <span class="n">varpath2</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;If varpath2 is supplied, remove the connection between varpath and</span>
<span class="sd">        varpath2. Otherwise, if varpath is the name of a trait, remove all</span>
<span class="sd">        connections to/from varpath in the current scope. If varpath is the</span>
<span class="sd">        name of a Component, remove all connections from all of its inputs</span>
<span class="sd">        and outputs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">varpath2</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">and</span> <span class="s">&#39;.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">varpath</span><span class="p">:</span>  <span class="c"># boundary var. make sure it&#39;s disconnected in parent</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">varpath</span><span class="p">]))</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprmapper</span><span class="o">.</span><span class="n">_exprgraph</span>
            <span class="n">to_remove</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprmapper</span><span class="o">.</span><span class="n">find_referring_exprs</span><span class="p">(</span><span class="n">varpath</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
                    <span class="n">to_remove</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">in_edges</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
                    <span class="n">to_remove</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[(</span><span class="n">varpath</span><span class="p">,</span> <span class="n">varpath2</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Assembly</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_exprmapper</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">varpath</span><span class="p">,</span> <span class="n">varpath2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Assembly.config_changed"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.config_changed">[docs]</a>    <span class="k">def</span> <span class="nf">config_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_parent</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call this whenever the configuration of this Component changes,</span>
<span class="sd">        for example, children are added or removed, connections are made</span>
<span class="sd">        or removed, etc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Assembly</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">config_changed</span><span class="p">(</span><span class="n">update_parent</span><span class="p">)</span>
        <span class="c"># driver must tell workflow that config has changed because</span>
        <span class="c"># dependencies may have changed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">config_changed</span><span class="p">(</span><span class="n">update_parent</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            
        <span class="c"># Detect and save any loops in the graph.</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_depgraph&#39;</span><span class="p">):</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_depgraph</span><span class="o">.</span><span class="n">_graph</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_graph_loops</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">strongly_connected_components</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Assembly.execute"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Runs driver and updates our boundary variables.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">ffd_order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ffd_order</span><span class="p">,</span> <span class="n">case_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_case_id</span><span class="p">)</span>

        <span class="n">valids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_dict</span>

        <span class="c"># now update boundary outputs</span>
        <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprmapper</span><span class="o">.</span><span class="n">get_output_exprs</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">valids</span><span class="p">[</span><span class="n">expr</span><span class="o">.</span><span class="n">text</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                <span class="n">srctxt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprmapper</span><span class="o">.</span><span class="n">get_source</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                <span class="n">srcexpr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprmapper</span><span class="o">.</span><span class="n">get_expr</span><span class="p">(</span><span class="n">srctxt</span><span class="p">)</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">srcexpr</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(),</span> <span class="n">src</span><span class="o">=</span><span class="n">srctxt</span><span class="p">)</span>
                <span class="c"># setattr(self, dest, srccomp.get_wrapped_attr(src))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># PassthroughProperty always valid for some reason.</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">dst_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trait</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">trait_type</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dst_type</span><span class="p">,</span> <span class="n">PassthroughProperty</span><span class="p">):</span>
                        <span class="n">srctxt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprmapper</span><span class="o">.</span><span class="n">get_source</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                        <span class="n">srcexpr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprmapper</span><span class="o">.</span><span class="n">get_expr</span><span class="p">(</span><span class="n">srctxt</span><span class="p">)</span>
                        <span class="n">expr</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">srcexpr</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(),</span> <span class="n">src</span><span class="o">=</span><span class="n">srctxt</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Assembly.step"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.step">[docs]</a>    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Execute a single child component and return.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Assembly.stop"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stop the calculation.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Assembly.list_connections"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.list_connections">[docs]</a>    <span class="k">def</span> <span class="nf">list_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_passthrough</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of tuples of the form (outvarname, invarname).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprmapper</span><span class="o">.</span><span class="n">list_connections</span><span class="p">(</span><span class="n">show_passthrough</span><span class="p">)</span>
</div>
    <span class="nd">@rbac</span><span class="p">((</span><span class="s">&#39;owner&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">))</span>
<div class="viewcode-block" id="Assembly.update_inputs"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.update_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">update_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compname</span><span class="p">,</span> <span class="n">exprs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Transfer input data to input expressions on the specified component.</span>
<span class="sd">        The exprs iterator is assumed to contain expression strings that reference</span>
<span class="sd">        component variables relative to the component, e.g., &#39;abc[3][1]&#39; rather</span>
<span class="sd">        than &#39;comp1.abc[3][1]&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">expr_info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">invalids</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">compname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprmapper</span><span class="o">.</span><span class="n">_exprgraph</span><span class="o">.</span><span class="n">pred</span>
            <span class="k">if</span> <span class="n">exprs</span><span class="p">:</span>
                <span class="n">ex</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">compname</span><span class="p">,</span> <span class="n">n</span><span class="p">])</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">exprs</span><span class="p">]</span>
                <span class="n">exprs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">ex</span><span class="p">:</span>
                    <span class="n">exprs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">expr</span> <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprmapper</span><span class="o">.</span><span class="n">find_referring_exprs</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                                  <span class="k">if</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">pred</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">exprs</span> <span class="o">=</span> <span class="p">[</span><span class="n">expr</span> <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprmapper</span><span class="o">.</span><span class="n">find_referring_exprs</span><span class="p">(</span><span class="n">compname</span><span class="p">)</span>
                             <span class="k">if</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">pred</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">exprs</span><span class="p">:</span>
            <span class="n">srctxt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprmapper</span><span class="o">.</span><span class="n">get_source</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">srctxt</span><span class="p">:</span>
                <span class="n">srcexpr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprmapper</span><span class="o">.</span><span class="n">get_expr</span><span class="p">(</span><span class="n">srctxt</span><span class="p">)</span>
                <span class="n">invalids</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">srcexpr</span><span class="o">.</span><span class="n">invalid_refs</span><span class="p">())</span>
                <span class="n">expr_info</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">srcexpr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exprmapper</span><span class="o">.</span><span class="n">get_expr</span><span class="p">(</span><span class="n">expr</span><span class="p">)))</span>

        <span class="c"># if source exprs reference invalid vars, request an update</span>
        <span class="k">if</span> <span class="n">invalids</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cname</span><span class="p">,</span> <span class="n">vnames</span> <span class="ow">in</span> <span class="n">partition_names_by_comp</span><span class="p">(</span><span class="n">invalids</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cname</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">update_inputs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">vnames</span><span class="p">)</span>
                        
                <span class="c"># If our source component is in a loop with us, don&#39;t</span>
                <span class="c"># run it. Otherwise you have infinite recursion. It is</span>
                <span class="c"># the responsibility of the solver to properly execute</span>
                <span class="c"># the comps in its loop.</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph_loops</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">loop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph_loops</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">compname</span> <span class="ow">in</span> <span class="n">loop</span> <span class="ow">and</span> <span class="n">cname</span> <span class="ow">in</span> <span class="n">loop</span><span class="p">:</span>
                            <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span><span class="o">.</span><span class="n">update_outputs</span><span class="p">(</span><span class="n">vnames</span><span class="p">)</span>
                        
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span><span class="o">.</span><span class="n">update_outputs</span><span class="p">(</span><span class="n">vnames</span><span class="p">)</span>
                    <span class="c">#self.set_valid(vnames, True)</span>

        <span class="k">for</span> <span class="n">srcexpr</span><span class="p">,</span> <span class="n">destexpr</span> <span class="ow">in</span> <span class="n">expr_info</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">destexpr</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">srcexpr</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(),</span> <span class="n">src</span><span class="o">=</span><span class="n">srcexpr</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="s">&quot;cannot set &#39;</span><span class="si">%s</span><span class="s">&#39; from &#39;</span><span class="si">%s</span><span class="s">&#39;: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
                                     <span class="p">(</span><span class="n">destexpr</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">srcexpr</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)),</span> <span class="nb">type</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Assembly.update_outputs"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.update_outputs">[docs]</a>    <span class="k">def</span> <span class="nf">update_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outnames</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Execute any necessary internal or predecessor components in order</span>
<span class="sd">        to make the specified output variables valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">cname</span><span class="p">,</span> <span class="n">vnames</span> <span class="ow">in</span> <span class="n">partition_names_by_comp</span><span class="p">(</span><span class="n">outnames</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">cname</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>  <span class="c"># boundary outputs</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_inputs</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">vnames</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span><span class="o">.</span><span class="n">update_outputs</span><span class="p">(</span><span class="n">vnames</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_valid</span><span class="p">(</span><span class="n">vnames</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Assembly.get_valid"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.get_valid">[docs]</a>    <span class="k">def</span> <span class="nf">get_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of boolean values indicating whether the named</span>
<span class="sd">        variables are valid (True) or invalid (False). Entries in names may</span>
<span class="sd">        specify either direct traits of self or those of children.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
        <span class="n">posdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">name</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">)])</span>

        <span class="k">for</span> <span class="n">compname</span><span class="p">,</span> <span class="n">varnames</span> <span class="ow">in</span> <span class="n">partition_names_by_comp</span><span class="p">(</span><span class="n">names</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">compname</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Assembly</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_valid</span><span class="p">(</span><span class="n">varnames</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
                    <span class="n">ret</span><span class="p">[</span><span class="n">posdict</span><span class="p">[</span><span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">comp</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compname</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">Component</span><span class="p">):</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get_valid</span><span class="p">(</span><span class="n">varnames</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_valid_dict</span><span class="p">[</span><span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">compname</span><span class="p">,</span> <span class="n">vname</span><span class="p">])]</span> <span class="k">for</span> <span class="n">vname</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
                    <span class="n">full</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">compname</span><span class="p">,</span> <span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                    <span class="n">ret</span><span class="p">[</span><span class="n">posdict</span><span class="p">[</span><span class="n">full</span><span class="p">]]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">ret</span>
</div>
    <span class="k">def</span> <span class="nf">_input_updated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">fullpath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>  <span class="c"># if var is not already invalid</span>
            <span class="n">outs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">invalidate_deps</span><span class="p">(</span><span class="n">varnames</span><span class="o">=</span><span class="nb">set</span><span class="p">([</span><span class="n">name</span><span class="p">]))</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">outs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">outs</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">child_invalidated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">outs</span><span class="p">)</span>

<div class="viewcode-block" id="Assembly.child_invalidated"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.child_invalidated">[docs]</a>    <span class="k">def</span> <span class="nf">child_invalidated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">childname</span><span class="p">,</span> <span class="n">outs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Invalidate all variables that depend on the outputs provided</span>
<span class="sd">        by the child that has been invalidated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bouts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_depgraph</span><span class="o">.</span><span class="n">invalidate_deps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="n">childname</span><span class="p">],</span> <span class="p">[</span><span class="n">outs</span><span class="p">],</span> <span class="n">force</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bouts</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">child_invalidated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">bouts</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bouts</span>
</div>
<div class="viewcode-block" id="Assembly.invalidate_deps"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.invalidate_deps">[docs]</a>    <span class="k">def</span> <span class="nf">invalidate_deps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varnames</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Mark all Variables invalid that depend on varnames.</span>
<span class="sd">        Returns a list of our newly invalidated boundary outputs.</span>

<span class="sd">        varnames: iter of str (optional)</span>
<span class="sd">            An iterator of names of destination variables.</span>

<span class="sd">        force: bool (optional)</span>
<span class="sd">            If True, force the invalidation to proceed beyond the</span>
<span class="sd">            boundary even if all outputs were already invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_dict</span>
        <span class="n">conn_ins</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_inputs</span><span class="p">(</span><span class="n">connected</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

        <span class="c"># If varnames is None, we&#39;re being called from a parent Assembly</span>
        <span class="c"># as part of a higher level invalidation, so we only need to look</span>
        <span class="c"># at our connected inputs</span>
        <span class="k">if</span> <span class="n">varnames</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">conn_ins</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">varnames</span>

        <span class="c"># We only care about inputs that are changing from valid to invalid.</span>
        <span class="c"># If they&#39;re already invalid, then we&#39;ve already done what we needed to do,</span>
        <span class="c"># unless force is True, in which case we continue with the invalidation.</span>
        <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
            <span class="n">invalidated_ins</span> <span class="o">=</span> <span class="n">names</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">invalidated_ins</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="s">&#39;.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">valids</span><span class="p">[</span><span class="n">name</span><span class="p">])</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_valid</span><span class="p">([</span><span class="n">name</span><span class="p">])[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">invalidated_ins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">invalidated_ins</span><span class="p">:</span>  <span class="c"># no newly invalidated inputs, so no outputs change status</span>
                <span class="k">return</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_exec_state</span><span class="p">(</span><span class="s">&#39;INVALID&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">varnames</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_valid</span><span class="p">(</span><span class="n">invalidated_ins</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c"># only invalidate *connected* inputs, because unconnected inputs</span>
               <span class="c"># are always valid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_valid</span><span class="p">([</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">invalidated_ins</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">conn_ins</span><span class="p">],</span> <span class="bp">False</span><span class="p">)</span>

        <span class="n">outs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_depgraph</span><span class="o">.</span><span class="n">invalidate_deps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;@bin&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">invalidated_ins</span><span class="p">],</span> <span class="n">force</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">outs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_valid</span><span class="p">(</span><span class="n">outs</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">outs</span>
</div>
<div class="viewcode-block" id="Assembly.exec_counts"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.exec_counts">[docs]</a>    <span class="k">def</span> <span class="nf">exec_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compnames</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">exec_count</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">compnames</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Assembly.calc_derivatives"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.calc_derivatives">[docs]</a>    <span class="k">def</span> <span class="nf">calc_derivatives</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">savebase</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Overides the component&#39;s version of this function. An assembly</span>
<span class="sd">        must initiate the call of calc_derivatives on all components in its</span>
<span class="sd">        driver&#39;s workflow.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">calc_derivatives</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">savebase</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Assembly.check_derivatives"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.check_derivatives">[docs]</a>    <span class="k">def</span> <span class="nf">check_derivatives</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">driver_inputs</span><span class="p">,</span> <span class="n">driver_outputs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;An assembly just tells its driver to run check_derivatives on each</span>
<span class="sd">        element in its workflow. Note that an assembly signifies a change of</span>
<span class="sd">        scope, so the driver input and output lists are pared down.&quot;&quot;&quot;</span>

        <span class="c"># Put the driver connection lists into our local scope by removing</span>
        <span class="c"># the assembly name from the dotted path.</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">driver_inputs</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>

                <span class="n">tuple_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">tup_item</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                    <span class="n">names</span> <span class="o">=</span> <span class="n">tup_item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                        <span class="n">tuple_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tuple_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tup_item</span><span class="p">)</span>

                <span class="n">driver_inputs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">tuple_list</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">names</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                    <span class="n">driver_inputs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">driver_outputs</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>

                <span class="n">tuple_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">tup_item</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                    <span class="n">names</span> <span class="o">=</span> <span class="n">tup_item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                        <span class="n">tuple_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tuple_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tup_item</span><span class="p">)</span>

                <span class="n">driver_inputs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">tuple_list</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">names</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                    <span class="n">driver_outputs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">check_derivatives</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">driver_inputs</span><span class="p">,</span> <span class="n">driver_outputs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Assembly.list_components"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.list_components">[docs]</a>    <span class="k">def</span> <span class="nf">list_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; List the components in the assembly.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_containers</span><span class="p">()</span>
                     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">Component</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">names</span>
</div>
<div class="viewcode-block" id="Assembly.get_dataflow"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.get_dataflow">[docs]</a>    <span class="k">def</span> <span class="nf">get_dataflow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Get a dictionary of components and the connections between them</span>
<span class="sd">            that make up the data flow for the assembly;</span>
<span class="sd">            also includes parameter, constraint, and objective flows.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">components</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">connections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">constraints</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">objectives</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># list of components (name &amp; type) in the assembly</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_depgraph</span><span class="o">.</span><span class="n">_graph</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">nx</span><span class="o">.</span><span class="n">algorithms</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">topological_sort</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
                               <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;@&#39;</span><span class="p">)]</span>

        <span class="c"># Bubble-up drivers ahead of their parameter targets.</span>
        <span class="n">sorted_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">Driver</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="s">&#39;_delegates_&#39;</span><span class="p">):</span>
                <span class="n">driver_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_names</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">dname</span><span class="p">,</span> <span class="n">dclass</span> <span class="ow">in</span> <span class="n">comp</span><span class="o">.</span><span class="n">_delegates_</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">dname</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">HasParameters</span><span class="p">):</span>
                        <span class="n">refs</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">get_referenced_compnames</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">refs</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">target_index</span> <span class="o">=</span> <span class="n">sorted_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                <span class="k">pass</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">driver_index</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">driver_index</span><span class="p">,</span> <span class="n">target_index</span><span class="p">)</span>
                <span class="n">sorted_names</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">driver_index</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sorted_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c"># Process names in new order.</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sorted_names</span><span class="p">:</span>
                <span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">Component</span><span class="p">):</span>
                    <span class="n">inames</span> <span class="o">=</span> <span class="p">[</span><span class="n">cls</span><span class="o">.</span><span class="n">__name__</span>
                              <span class="k">for</span> <span class="n">cls</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">implementedBy</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">__class__</span><span class="p">))]</span>
                    <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">comp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="s">&#39;pathname&#39;</span><span class="p">:</span> <span class="n">comp</span><span class="o">.</span><span class="n">get_pathname</span><span class="p">(),</span>
                        <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                        <span class="s">&#39;valid&#39;</span><span class="p">:</span> <span class="n">comp</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span>
                        <span class="s">&#39;interfaces&#39;</span><span class="p">:</span> <span class="n">inames</span><span class="p">,</span>
                        <span class="s">&#39;python_id&#39;</span><span class="p">:</span> <span class="nb">id</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
                    <span class="p">})</span>

                <span class="k">if</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">Driver</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="s">&#39;_delegates_&#39;</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">dclass</span> <span class="ow">in</span> <span class="n">comp</span><span class="o">.</span><span class="n">_delegates_</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">HasParameters</span><span class="p">):</span>
                                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">inst</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">ParameterGroup</span><span class="p">):</span>
                                        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">targets</span><span class="p">)):</span>
                                            <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">comp</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">])</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">comp</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">,</span>
                                                           <span class="n">param</span><span class="o">.</span><span class="n">target</span><span class="p">])</span>
                            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="p">(</span><span class="n">HasConstraints</span><span class="p">,</span>
                                                   <span class="n">HasEqConstraints</span><span class="p">,</span>
                                                   <span class="n">HasIneqConstraints</span><span class="p">)):</span>
                                <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">inst</span><span class="o">.</span><span class="n">get_referenced_varpaths</span><span class="p">():</span>
                                    <span class="n">name</span><span class="p">,</span> <span class="n">dot</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
                                    <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">path</span><span class="p">,</span>
                                                        <span class="n">comp</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">rest</span><span class="p">])</span>
                            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="p">(</span><span class="n">HasObjective</span><span class="p">,</span>
                                                   <span class="n">HasObjectives</span><span class="p">)):</span>
                                <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">inst</span><span class="o">.</span><span class="n">get_referenced_varpaths</span><span class="p">():</span>
                                    <span class="n">name</span><span class="p">,</span> <span class="n">dot</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
                                    <span class="n">objectives</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">path</span><span class="p">,</span>
                                                       <span class="n">comp</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">])</span>

        <span class="c"># list of connections (convert tuples to lists)</span>
        <span class="n">conntuples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_connections</span><span class="p">(</span><span class="n">show_passthrough</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">connection</span> <span class="ow">in</span> <span class="n">conntuples</span><span class="p">:</span>
            <span class="n">connections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">connection</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">{</span><span class="s">&#39;components&#39;</span><span class="p">:</span> <span class="n">components</span><span class="p">,</span> <span class="s">&#39;connections&#39;</span><span class="p">:</span> <span class="n">connections</span><span class="p">,</span>
                <span class="s">&#39;parameters&#39;</span><span class="p">:</span> <span class="n">parameters</span><span class="p">,</span> <span class="s">&#39;constraints&#39;</span><span class="p">:</span> <span class="n">constraints</span><span class="p">,</span>
                <span class="s">&#39;objectives&#39;</span><span class="p">:</span> <span class="n">objectives</span><span class="p">}</span>
</div>
<div class="viewcode-block" id="Assembly.get_connections"><a class="viewcode-back" href="../../../srcdocs/packages/openmdao.main.html#openmdao.main.assembly.Assembly.get_connections">[docs]</a>    <span class="k">def</span> <span class="nf">get_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_name</span><span class="p">,</span> <span class="n">dst_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Get a list of the outputs from the component *src_name* (sources),</span>
<span class="sd">            the inputs to the component *dst_name* (destinations) and the</span>
<span class="sd">            connections between them.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">conns</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c"># outputs</span>
        <span class="n">sources</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">src_name</span><span class="p">:</span>
            <span class="n">src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">src_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">src</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">connected</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">(</span><span class="n">connected</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">():</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">vtype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>  <span class="c"># vartree vars handled separately</span>
                <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="n">meta</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">meta</span> <span class="ow">and</span> <span class="s">&#39;units&#39;</span> <span class="ow">in</span> <span class="n">meta</span><span class="p">:</span>
                    <span class="n">units</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s">&#39;units&#39;</span><span class="p">]</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">get_valid</span><span class="p">([</span><span class="n">name</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                    <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="n">vtype</span><span class="p">,</span>
                    <span class="s">&#39;valid&#39;</span><span class="p">:</span> <span class="n">valid</span><span class="p">,</span>
                    <span class="s">&#39;units&#39;</span><span class="p">:</span> <span class="n">units</span><span class="p">,</span>
                    <span class="s">&#39;connected&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">)</span>
                <span class="p">})</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">VariableTree</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">list_vars</span><span class="p">():</span>
                    <span class="n">vt_var</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
                    <span class="n">vt_var_name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">var_name</span>
                    <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="n">meta</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">meta</span> <span class="ow">and</span> <span class="s">&#39;units&#39;</span> <span class="ow">in</span> <span class="n">meta</span><span class="p">:</span>
                        <span class="n">units</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s">&#39;units&#39;</span><span class="p">]</span>
                    <span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">vt_var_name</span><span class="p">,</span>
                        <span class="s">&#39;type&#39;</span><span class="p">:</span>  <span class="nb">type</span><span class="p">(</span><span class="n">vt_var</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                        <span class="s">&#39;valid&#39;</span><span class="p">:</span> <span class="n">valid</span><span class="p">,</span>
                        <span class="s">&#39;units&#39;</span><span class="p">:</span> <span class="n">units</span><span class="p">,</span>
                        <span class="s">&#39;connected&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">vt_var_name</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">)</span>
                    <span class="p">})</span>
            <span class="k">elif</span> <span class="n">vtype</span> <span class="o">==</span> <span class="s">&#39;ndarray&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)):</span>
                    <span class="n">vname</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;]&#39;</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">__name__</span>
                    <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">vname</span><span class="p">,</span>
                        <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="n">dtype</span><span class="p">,</span>
                        <span class="s">&#39;valid&#39;</span><span class="p">:</span> <span class="n">valid</span><span class="p">,</span>
                        <span class="s">&#39;units&#39;</span><span class="p">:</span> <span class="n">units</span><span class="p">,</span>
                        <span class="s">&#39;connected&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">vname</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">)</span>
                    <span class="p">})</span>

        <span class="c"># connections to assembly can be passthrough (input to input)</span>
        <span class="k">if</span> <span class="n">src</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">connected</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">list_inputs</span><span class="p">(</span><span class="n">connected</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">list_inputs</span><span class="p">():</span>
                <span class="n">var</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">vtype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>  <span class="c"># vartree vars handled separately</span>
                    <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="n">meta</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">meta</span> <span class="ow">and</span> <span class="s">&#39;units&#39;</span> <span class="ow">in</span> <span class="n">meta</span><span class="p">:</span>
                        <span class="n">units</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s">&#39;units&#39;</span><span class="p">]</span>
                    <span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                        <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="n">vtype</span><span class="p">,</span>
                        <span class="s">&#39;valid&#39;</span><span class="p">:</span> <span class="n">src</span><span class="o">.</span><span class="n">get_valid</span><span class="p">([</span><span class="n">name</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="s">&#39;units&#39;</span><span class="p">:</span> <span class="n">units</span><span class="p">,</span>
                        <span class="s">&#39;connected&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">)</span>
                    <span class="p">})</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">VariableTree</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">list_vars</span><span class="p">():</span>
                        <span class="n">vt_var</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
                        <span class="n">vt_var_name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">var_name</span>
                        <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                        <span class="n">meta</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">meta</span> <span class="ow">and</span> <span class="s">&#39;units&#39;</span> <span class="ow">in</span> <span class="n">meta</span><span class="p">:</span>
                            <span class="n">units</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s">&#39;units&#39;</span><span class="p">]</span>
                        <span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">vt_var_name</span><span class="p">,</span>
                            <span class="s">&#39;type&#39;</span><span class="p">:</span>  <span class="nb">type</span><span class="p">(</span><span class="n">vt_var</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                            <span class="s">&#39;valid&#39;</span><span class="p">:</span> <span class="n">valid</span><span class="p">,</span>
                            <span class="s">&#39;units&#39;</span><span class="p">:</span> <span class="n">units</span><span class="p">,</span>
                            <span class="s">&#39;connected&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">vt_var_name</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">)</span>
                        <span class="p">})</span>
                <span class="k">elif</span> <span class="n">vtype</span> <span class="o">==</span> <span class="s">&#39;ndarray&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)):</span>
                        <span class="n">vname</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;]&#39;</span>
                        <span class="n">dtype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">__name__</span>
                        <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                        <span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">vname</span><span class="p">,</span>
                            <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="n">dtype</span><span class="p">,</span>
                            <span class="s">&#39;valid&#39;</span><span class="p">:</span> <span class="n">valid</span><span class="p">,</span>
                            <span class="s">&#39;units&#39;</span><span class="p">:</span> <span class="n">units</span><span class="p">,</span>
                            <span class="s">&#39;connected&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">vname</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">)</span>
                        <span class="p">})</span>

        <span class="n">conns</span><span class="p">[</span><span class="s">&#39;sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sources</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>

        <span class="c"># inputs</span>
        <span class="n">dests</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">dst_name</span><span class="p">:</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dst_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">connected</span> <span class="o">=</span> <span class="n">dst</span><span class="o">.</span><span class="n">list_inputs</span><span class="p">(</span><span class="n">connected</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dst</span><span class="o">.</span><span class="n">list_inputs</span><span class="p">():</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">vtype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>  <span class="c"># vartree vars handled separately</span>
                <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="n">meta</span> <span class="o">=</span> <span class="n">dst</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">meta</span> <span class="ow">and</span> <span class="s">&#39;units&#39;</span> <span class="ow">in</span> <span class="n">meta</span><span class="p">:</span>
                    <span class="n">units</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s">&#39;units&#39;</span><span class="p">]</span>
                <span class="n">dests</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                    <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="n">vtype</span><span class="p">,</span>
                    <span class="s">&#39;valid&#39;</span><span class="p">:</span> <span class="n">dst</span><span class="o">.</span><span class="n">get_valid</span><span class="p">([</span><span class="n">name</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s">&#39;units&#39;</span><span class="p">:</span> <span class="n">units</span><span class="p">,</span>
                    <span class="s">&#39;connected&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">)</span>
                <span class="p">})</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">VariableTree</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">list_vars</span><span class="p">():</span>
                    <span class="n">vt_var</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
                    <span class="n">vt_var_name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">var_name</span>
                    <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="n">meta</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">meta</span> <span class="ow">and</span> <span class="s">&#39;units&#39;</span> <span class="ow">in</span> <span class="n">meta</span><span class="p">:</span>
                        <span class="n">units</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s">&#39;units&#39;</span><span class="p">]</span>
                    <span class="n">dests</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">vt_var_name</span><span class="p">,</span>
                        <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">vt_var</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                        <span class="s">&#39;valid&#39;</span><span class="p">:</span> <span class="n">valid</span><span class="p">,</span>
                        <span class="s">&#39;units&#39;</span><span class="p">:</span> <span class="n">units</span><span class="p">,</span>
                        <span class="s">&#39;connected&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">vt_var_name</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">)</span>
                    <span class="p">})</span>
            <span class="k">elif</span> <span class="n">vtype</span> <span class="o">==</span> <span class="s">&#39;ndarray&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)):</span>
                    <span class="n">vname</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;]&#39;</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">__name__</span>
                    <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="n">dests</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">vname</span><span class="p">,</span>
                        <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="n">dtype</span><span class="p">,</span>
                        <span class="s">&#39;valid&#39;</span><span class="p">:</span> <span class="n">valid</span><span class="p">,</span>
                        <span class="s">&#39;units&#39;</span><span class="p">:</span> <span class="n">units</span><span class="p">,</span>
                        <span class="s">&#39;connected&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">vname</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">)</span>
                    <span class="p">})</span>

        <span class="c"># connections to assembly can be passthrough (output to output)</span>
        <span class="k">if</span> <span class="n">dst</span> <span class="o">==</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">connected</span> <span class="o">=</span> <span class="n">dst</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">(</span><span class="n">connected</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dst</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">():</span>
                <span class="n">var</span> <span class="o">=</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">vtype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>  <span class="c"># vartree vars handled separately</span>
                    <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="n">meta</span> <span class="o">=</span> <span class="n">dst</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">meta</span> <span class="ow">and</span> <span class="s">&#39;units&#39;</span> <span class="ow">in</span> <span class="n">meta</span><span class="p">:</span>
                        <span class="n">units</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s">&#39;units&#39;</span><span class="p">]</span>
                    <span class="n">dests</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                        <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                        <span class="s">&#39;valid&#39;</span><span class="p">:</span> <span class="n">dst</span><span class="o">.</span><span class="n">get_valid</span><span class="p">([</span><span class="n">name</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="s">&#39;units&#39;</span><span class="p">:</span> <span class="n">units</span><span class="p">,</span>
                        <span class="s">&#39;connected&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">)</span>
                    <span class="p">})</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">VariableTree</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">list_vars</span><span class="p">():</span>
                        <span class="n">vt_var</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
                        <span class="n">vt_var_name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">var_name</span>
                        <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                        <span class="n">meta</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">meta</span> <span class="ow">and</span> <span class="s">&#39;units&#39;</span> <span class="ow">in</span> <span class="n">meta</span><span class="p">:</span>
                            <span class="n">units</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s">&#39;units&#39;</span><span class="p">]</span>
                        <span class="n">dests</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">vt_var_name</span><span class="p">,</span>
                            <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">vt_var</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                            <span class="s">&#39;valid&#39;</span><span class="p">:</span> <span class="n">valid</span><span class="p">,</span>
                            <span class="s">&#39;units&#39;</span><span class="p">:</span> <span class="n">units</span><span class="p">,</span>
                            <span class="s">&#39;connected&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">vt_var_name</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">)</span>
                        <span class="p">})</span>
                <span class="k">elif</span> <span class="n">vtype</span> <span class="o">==</span> <span class="s">&#39;ndarray&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)):</span>
                        <span class="n">vname</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;]&#39;</span>
                        <span class="n">dtype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">__name__</span>
                        <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                        <span class="n">dests</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">vname</span><span class="p">,</span>
                            <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="n">dtype</span><span class="p">,</span>
                            <span class="s">&#39;valid&#39;</span><span class="p">:</span> <span class="n">valid</span><span class="p">,</span>
                            <span class="s">&#39;units&#39;</span><span class="p">:</span> <span class="n">units</span><span class="p">,</span>
                            <span class="s">&#39;connected&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">vname</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">)</span>
                        <span class="p">})</span>

        <span class="n">conns</span><span class="p">[</span><span class="s">&#39;destinations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">dests</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>

        <span class="c"># connections</span>
        <span class="n">connections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">conntuples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_connections</span><span class="p">(</span><span class="n">show_passthrough</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">comp_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_components</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">src_var</span><span class="p">,</span> <span class="n">dst_var</span> <span class="ow">in</span> <span class="n">conntuples</span><span class="p">:</span>
            <span class="n">src_root</span> <span class="o">=</span> <span class="n">src_var</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dst_root</span> <span class="o">=</span> <span class="n">dst_var</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(((</span><span class="n">src_name</span> <span class="ow">and</span> <span class="n">src_root</span> <span class="o">==</span> <span class="n">src_name</span><span class="p">)</span> <span class="ow">or</span>
                 <span class="p">(</span><span class="ow">not</span> <span class="n">src_name</span> <span class="ow">and</span> <span class="n">src_root</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">comp_names</span><span class="p">))</span> <span class="ow">and</span>
                <span class="p">((</span><span class="n">dst_name</span> <span class="ow">and</span> <span class="n">dst_root</span> <span class="o">==</span> <span class="n">dst_name</span><span class="p">)</span> <span class="ow">or</span>
                 <span class="p">(</span><span class="ow">not</span> <span class="n">dst_name</span> <span class="ow">and</span> <span class="n">dst_root</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">comp_names</span><span class="p">))):</span>
                <span class="n">connections</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">src_var</span><span class="p">,</span> <span class="n">dst_var</span><span class="p">])</span>
        <span class="n">conns</span><span class="p">[</span><span class="s">&#39;connections&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">connections</span>

        <span class="k">return</span> <span class="n">conns</span>

</div></div>
<span class="k">def</span> <span class="nf">dump_iteration_tree</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a text version of the iteration tree</span>
<span class="sd">    of an OpenMDAO object or hierarchy.  The tree</span>
<span class="sd">    shows which are being iterated over by which</span>
<span class="sd">    drivers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_dump_iteration_tree</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">tablevel</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Driver</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="n">tablevel</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">get_pathname</span><span class="p">())</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">workflow</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">Driver</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">Assembly</span><span class="p">):</span>
                    <span class="n">_dump_iteration_tree</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">tablevel</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">tablevel</span> <span class="o">+</span> <span class="mi">3</span><span class="p">))</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">get_pathname</span><span class="p">())</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">is_instance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Assembly</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="n">tablevel</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">get_pathname</span><span class="p">())</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">_dump_iteration_tree</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">tablevel</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cStringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">_dump_iteration_tree</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<a href="http://openmdao.org">
 <img src="../../../_static/OpenMDAO_Logo_200w_padded.png"
border="0" alt="OpenMDAO Home"/>
</a>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../../../index.html">OpenMDAO Documentation v0.8.1</a> &raquo;</li>

          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright none.
      Last updated on Aug 26, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>