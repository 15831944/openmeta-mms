
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Assemblies &mdash; OpenMDAO Documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.8.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="OpenMDAO Documentation" href="../../index.html" />
    <link rel="up" title="A More Complex Tutorial Problem" href="index.html" />
    <link rel="next" title="Drivers for Simulation" href="drivers.html" />
    <link rel="prev" title="Wrapping an External Module Using F2PY" href="external_module.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="drivers.html" title="Drivers for Simulation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="external_module.html" title="Wrapping an External Module Using F2PY"
             accesskey="P">previous</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../../index.html">OpenMDAO Documentation v0.8.1</a> &raquo;</li>

          <li><a href="../index.html" >OpenMDAO Tutorials</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">A More Complex Tutorial Problem</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="assemblies">
<span id="index-0"></span><h1>Assemblies<a class="headerlink" href="#assemblies" title="Permalink to this headline">Â¶</a></h1>
<p>Now that we&#8217;ve created Python components representing the three vehicle
subsystems, we need to connect them so that they can be executed in sequence.
Recall that an OpenMDAO component that contains a collection of other
components is called an <a class="reference internal" href="../../glossary.html#term-assembly"><em class="xref std std-term">Assembly</em></a>. The Assembly allows a set of
components to be linked together by connecting their inputs and outputs. The
data connections define an execution order based on their dependencies, i.e.,
components that are upstream in the data flow will be executed prior to those
downstream so that input data to a component will always be valid with respect
to the other parts of the workflow. A component will not execute if its inputs
have not changed since its last execution. An Assembly contains a
Driver called <em>driver</em> that controls iterations over the workflow.</p>
<p>For the vehicle simulation, a Vehicle assembly is needed that can sequentially execute the Transmission,
Engine, and Chassis components.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openmdao.main.api</span> <span class="kn">import</span> <span class="n">Assembly</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.datatypes.api</span> <span class="kn">import</span> <span class="n">Float</span>

<span class="kn">from</span> <span class="nn">openmdao.examples.enginedesign.transmission</span> <span class="kn">import</span> <span class="n">Transmission</span>
<span class="kn">from</span> <span class="nn">openmdao.examples.enginedesign.chassis</span> <span class="kn">import</span> <span class="n">Chassis</span>
<span class="kn">from</span> <span class="nn">openmdao.examples.enginedesign.engine_wrap_c</span> <span class="kn">import</span> <span class="n">Engine</span>

<span class="k">class</span> <span class="nc">Vehicle</span><span class="p">(</span><span class="n">Assembly</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Vehicle assembly. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># Create component instances</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;transmission&#39;</span><span class="p">,</span> <span class="n">Transmission</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;engine&#39;</span><span class="p">,</span> <span class="n">Engine</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;chassis&#39;</span><span class="p">,</span> <span class="n">Chassis</span><span class="p">())</span>

        <span class="c"># Set up the workflow</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s">&#39;transmission&#39;</span><span class="p">,</span> <span class="s">&#39;engine&#39;</span><span class="p">,</span> <span class="s">&#39;chassis&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>The Engine, Transmission, and Chassis components all need to be imported so
their instances can be created; they can be added to the assembly
with <tt class="docutils literal"><span class="pre">add</span></tt>. Please notice that an assembly inherits from Assembly
instead of from Component. We also need to add the instances to the driver&#8217;s
workflow using the <tt class="docutils literal"><span class="pre">add</span></tt> method. Note that the order we add these doesn&#8217;t
matter here, because the  execution order is inferred from the data connections,
which we now need to make.</p>
<p>Now that the components are instantiated in the assembly, they need to be hooked up:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;transmission.RPM&#39;</span><span class="p">,</span><span class="s">&#39;engine.RPM&#39;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;transmission.torque_ratio&#39;</span><span class="p">,</span><span class="s">&#39;chassis.torque_ratio&#39;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;engine.torque&#39;</span><span class="p">,</span><span class="s">&#39;chassis.engine_torque&#39;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;engine.engine_weight&#39;</span><span class="p">,</span><span class="s">&#39;chassis.mass_engine&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The first argument in the call to <tt class="docutils literal"><span class="pre">self.connect</span></tt> is the output variable of
the source component instance, and the second argument is the input variable
of the target component instance. For a connection to be valid, the units of
the output and input must be compatible (e.g., length, speed, etc.) If
they differ within the same class (e.g., meters vs. inches), then the value is
converted from the source unit to the target unit before setting the value at
the input. If the classes are incompatible (e.g., meters vs. seconds), then an
exception is raised during execution.</p>
<p>The Vehicle assembly also has inputs and outputs, and it can be hooked up to
other components and included in other assemblies once its variables
are defined. We would like to promote all of the design and simulation
variables from the Engine, Transmission, and Chassis components to the input
and output of the Vehicle assembly. OpenMDAO includes a shortcut for doing
this quickly by creating <em>passthroughs</em>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">create_passthrough</span><span class="p">(</span><span class="s">&#39;engine.stroke&#39;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">create_passthrough</span><span class="p">(</span><span class="s">&#39;engine.bore&#39;</span><span class="p">)</span>
<span class="c"># ...</span>
<span class="c"># ...</span>
<span class="bp">self</span><span class="o">.</span><span class="n">create_passthrough</span><span class="p">(</span><span class="s">&#39;transmission.ratio1&#39;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">create_passthrough</span><span class="p">(</span><span class="s">&#39;transmission.ratio2&#39;</span><span class="p">)</span>
<span class="c"># ...</span>
<span class="c"># ...</span>
<span class="bp">self</span><span class="o">.</span><span class="n">create_passthrough</span><span class="p">(</span><span class="s">&#39;chassis.mass_vehicle&#39;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">create_passthrough</span><span class="p">(</span><span class="s">&#39;chassis.Cf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">create_passthrough</span></tt> function creates an identical variable
in the assembly and connects it to the corresponding component variable. So now, all of the
design variables are available as variables in any simulation that includes an instance
of the vehicle model.</p>
<p>However, the engine tutorial throws you a curve ball here. The Engine
and Chassis components are defined with SI units, but the Transmission
component is defined with English units. We have two inputs &#8211; the tire
circumference and the vehicle velocity &#8211; that are each used by two components
with different units. The <tt class="docutils literal"><span class="pre">create_passthrough</span></tt> function creates an exact copy
of the variable, so we cannot use it here. Instead, we must connect them manually
by declaring variables in our assembly.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Vehicle</span><span class="p">(</span><span class="n">Assembly</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Vehicle assembly. &quot;&quot;&quot;</span>

    <span class="n">tire_circumference</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">75.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;inch&#39;</span><span class="p">,</span>
                        <span class="n">desc</span><span class="o">=</span><span class="s">&#39;Circumference of tire (inches)&#39;</span><span class="p">)</span>

    <span class="n">velocity</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">75.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;mi/h&#39;</span><span class="p">,</span>
               <span class="n">desc</span><span class="o">=</span><span class="s">&#39;Vehicle velocity needed to determine engine RPM (mi/h)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now these inputs are available to connect to the components, so we connect them manually.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;velocity&#39;</span><span class="p">,</span>
             <span class="p">[</span><span class="s">&#39;chassis.velocity&#39;</span><span class="p">,</span> <span class="s">&#39;transmission.velocity&#39;</span><span class="p">])</span>
<span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tire_circumference&#39;</span><span class="p">,</span>
             <span class="p">[</span><span class="s">&#39;chassis.tire_circ&#39;</span><span class="p">,</span> <span class="s">&#39;transmission.tire_circ&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>This ensures that the units for these inputs to the Vehicle are converted properly for use in the Chassis and
Transmission components. While this might seem redundant, it demonstrates
a way that Assemblies can be used to define a more consistent external interface.</p>
</div>
<div class="section" id="executing-the-vehicle-assembly">
<h1>Executing the Vehicle Assembly<a class="headerlink" href="#executing-the-vehicle-assembly" title="Permalink to this headline">Â¶</a></h1>
<p>We can manipulate the Vehicle Assembly in the Python shell just like we did with the engine component
above. As inputs, the Vehicle takes a commanded velocity, throttle position, a gear position, and
a set of vehicle design parameters, and outputs the vehicle&#8217;s instantaneous acceleration and rate of fuel
burn.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">openmdao.main.api</span> <span class="kn">import</span> <span class="n">set_as_top</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">openmdao.examples.enginedesign.vehicle</span> <span class="kn">import</span> <span class="n">Vehicle</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_car</span> <span class="o">=</span> <span class="n">set_as_top</span><span class="p">(</span><span class="n">Vehicle</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_car</span><span class="o">.</span><span class="n">velocity</span> <span class="o">=</span> <span class="mf">25.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_car</span><span class="o">.</span><span class="n">current_gear</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_car</span><span class="o">.</span><span class="n">throttle</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_car</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_car</span><span class="o">.</span><span class="n">acceleration</span>
<span class="go">1.1086409681...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_car</span><span class="o">.</span><span class="n">fuel_burn</span>
<span class="go">0.0027991856...</span>
</pre></div>
</div>
<p>When we run the Vehicle, we are performing a simple multidisciplinary analysis via the
OpenMDAO framework. Try setting the simulation variables to other values, including ones that should
trigger an exception. (One way to do this is to command a high velocity in first gear, which should
violate the maximum RPM that the engine allows.)</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<a href="http://openmdao.org">
 <img src="../../_static/OpenMDAO_Logo_200w_padded.png"
border="0" alt="OpenMDAO Home"/>
</a>

  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Assemblies</a></li>
<li><a class="reference internal" href="#executing-the-vehicle-assembly">Executing the Vehicle Assembly</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="external_module.html"
                        title="previous chapter">Wrapping an External Module Using F2PY</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="drivers.html"
                        title="next chapter">Drivers for Simulation</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/tutorials/complex/assemblies.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="drivers.html" title="Drivers for Simulation"
             >next</a> |</li>
        <li class="right" >
          <a href="external_module.html" title="Wrapping an External Module Using F2PY"
             >previous</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../../index.html">OpenMDAO Documentation v0.8.1</a> &raquo;</li>

          <li><a href="../index.html" >OpenMDAO Tutorials</a> &raquo;</li>
          <li><a href="index.html" >A More Complex Tutorial Problem</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright none.
      Last updated on Aug 26, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>