
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Components and Variables &mdash; OpenMDAO Documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.8.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="OpenMDAO Documentation" href="../../index.html" />
    <link rel="up" title="A More Complex Tutorial Problem" href="index.html" />
    <link rel="next" title="Executing a Component in the Python Shell" href="python_shell.html" />
    <link rel="prev" title="Problem Overview" href="overview.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="python_shell.html" title="Executing a Component in the Python Shell"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="Problem Overview"
             accesskey="P">previous</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../../index.html">OpenMDAO Documentation v0.8.1</a> &raquo;</li>

          <li><a href="../index.html" >OpenMDAO Tutorials</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">A More Complex Tutorial Problem</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="components-and-variables">
<span id="index-0"></span><h1>Components and Variables<a class="headerlink" href="#components-and-variables" title="Permalink to this headline">Â¶</a></h1>
<p>In the previous section, three component models were outlined that together form a vehicle model that can simulate
performance. These models have all been implemented as OpenMDAO components written in Python. This
section will examine these components.</p>
<p>The following instructions will help you locate the directory containing the pieces
needed for the model.</p>
<p>If you have downloaded the latest release version from the website, the files you need should be
here:</p>
<div class="highlight-python"><pre>openmdao-X.X.X/lib/python2.6/site-packages/openmdao.examples.enginedesign-X.X.X-######.egg/openmdao/examples/enginedesign</pre>
</div>
<p><tt class="docutils literal"><span class="pre">X.X.X</span></tt> is the current OpenMDAO version, and <tt class="docutils literal"><span class="pre">######</span></tt> is a string that
contains the Python version and the operating system description. This path will
vary depending on your system and version, but there will be only one
<em>enginedesign</em> egg.</p>
<p>If you are a developer and have a branch from the source repository, the files you need will be
here:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">examples</span><span class="o">/</span><span class="n">openmdao</span><span class="o">.</span><span class="n">examples</span><span class="o">.</span><span class="n">enginedesign</span><span class="o">/</span><span class="n">openmdao</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">enginedesign</span>
</pre></div>
</div>
<p>The three engine models have been implemented in <tt class="docutils literal"><span class="pre">transmission.py,</span> <span class="pre">engine.py,</span></tt> and <tt class="docutils literal"><span class="pre">chassis.py</span></tt>. It will
be useful to browse these files as you learn some of the basic concepts in this tutorial.</p>
<p><strong>Building a Python Component</strong></p>
<p>The first thing we will do is create an OpenMDAO Component called <em>Transmission.</em> You may recall
that a Component contains inputs and outputs and provides a method to calculate its outputs
from its inputs. We must create the variables that define these inputs and outputs.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openmdao.main.api</span> <span class="kn">import</span> <span class="n">Component</span><span class="p">,</span> <span class="n">convert_units</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.datatypes.api</span> <span class="kn">import</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span> <span class="n">Enum</span>


<span class="k">class</span> <span class="nc">Transmission</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A simple transmission model.&quot;&quot;&quot;</span>

    <span class="n">ratio1</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">3.54</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span>
                   <span class="n">desc</span><span class="o">=</span><span class="s">&#39;Gear ratio in First Gear&#39;</span><span class="p">)</span>
    <span class="n">ratio2</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">2.13</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span>
                   <span class="n">desc</span><span class="o">=</span><span class="s">&#39;Gear ratio in Second Gear&#39;</span><span class="p">)</span>
    <span class="n">ratio3</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.36</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span>
                   <span class="n">desc</span><span class="o">=</span><span class="s">&#39;Gear ratio in Third Gear&#39;</span><span class="p">)</span>
    <span class="n">ratio4</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span>
                   <span class="n">desc</span><span class="o">=</span><span class="s">&#39;Gear ratio in Fourth Gear&#39;</span><span class="p">)</span>
    <span class="n">ratio5</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.72</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span>
                   <span class="n">desc</span><span class="o">=</span><span class="s">&#39;Gear ratio in Fifth Gear&#39;</span><span class="p">)</span>
    <span class="n">final_drive_ratio</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span>
                              <span class="n">desc</span><span class="o">=</span><span class="s">&#39;Final Drive Ratio&#39;</span><span class="p">)</span>
    <span class="n">tire_circ</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">75.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;inch&#39;</span><span class="p">,</span>
                      <span class="n">desc</span><span class="o">=</span><span class="s">&#39;Circumference of tire (inches)&#39;</span><span class="p">)</span>

    <span class="n">current_gear</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;Current Gear&#39;</span><span class="p">,</span>
                        <span class="n">aliases</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;1st&#39;</span><span class="p">,</span><span class="s">&#39;2nd&#39;</span><span class="p">,</span><span class="s">&#39;3rd&#39;</span><span class="p">,</span><span class="s">&#39;4th&#39;</span><span class="p">,</span><span class="s">&#39;5th&#39;</span><span class="p">))</span>
    <span class="n">velocity</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;mi/h&#39;</span><span class="p">,</span>
                     <span class="n">desc</span><span class="o">=</span><span class="s">&#39;Current Velocity of Vehicle&#39;</span><span class="p">)</span>

    <span class="n">RPM</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1000.</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;rpm&#39;</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="s">&#39;Engine RPM&#39;</span><span class="p">)</span>
    <span class="n">torque_ratio</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span>
                         <span class="n">desc</span><span class="o">=</span><span class="s">&#39;Ratio of output torque to engine torque&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <em>Int</em> and <em>Float</em> variable types were introduced in other tutorials, but some new parameters are
used here, including the <em>Enum</em> type.</p>
<p id="index-1">In this example, we use more complicated names for our variables, so we should cover what makes a
valid variable name. Variables are also Python variables, so they must follow Python&#8217;s standard
naming convention. They must begin with a letter or underscore and should consist of only
alphanumeric characters and the underscore. Keep in mind that a leading underscore is generally used
for private data or functions. <strong>Spaces cannot be used in a variable name.</strong> Generally, we&#8217;ve tried
to follow the <a class="reference external" href="http://www.python.org/dev/peps/pep-0008/">PEP 8</a>  standard for component instance
names as well as Python variable names. PEP 8 prescribes the use of lower case names with words
separated by underscores.</p>
<p>The required parameter <em>iotype</em>, the optional parameter <em>desc</em>, and the
default value are covered in previous tutorials. The parameter <em>units</em> is
introduced here and is used in a few of the variables in Transmission. OpenMDAO contains a Units
module that allows for unit checking and conversion between outputs and
inputs of components. Our units definitions are based on the those given in
Scientific Python and can be found in <a class="reference internal" href="../../units.html#units"><em>Appendix: Summary of Units</em></a>. If a compatible output and
input are connected in the framework, the value is automatically
converted as it is passed from the output to the input. If an incompatible output and input
are connected (e.g., length and time), an exception is
raised. A variable with no units defined can be connected to a variable with units.</p>
<p><strong>Only the Float and Array types perform automatic unit conversion and checking.</strong></p>
<p>The Transmission component uses an enumerated list to define the valid gear positions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">current_gear</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;Current Gear&#39;</span><span class="p">,</span>
                <span class="n">aliases</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;1st&#39;</span><span class="p">,</span><span class="s">&#39;2nd&#39;</span><span class="p">,</span><span class="s">&#39;3rd&#39;</span><span class="p">,</span><span class="s">&#39;4th&#39;</span><span class="p">,</span><span class="s">&#39;5th&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>An <em>enumeration</em> is a discrete variable that has a finite number of valid states. This
transmission is a 5-speed manual, so the valid states are gears 1 through 5 and neutral. The
constructor begins with a default value and a <a class="reference internal" href="../../glossary.html#term-tuple"><em class="xref std std-term">tuple</em></a> containing all of the valid states. Sometimes
it is beneficial to add as the <em>alias</em> parameter a second tuple containing a more descriptive
tag. In this case, the alias <em>&#8216;N&#8217;</em> tells you that a value of 0 sets the gear to Neutral. The
Enum is not type-restrictive. You could use the alias strings as the values, though typically
the values are needed because you have some code that operates on an integer number. In our
case, our simulation will upshift by adding 1 to the current gear, which it couldn&#8217;t do to
the strings. For more information, see <a class="reference internal" href="../../basics/variables.html#enums"><em>Enums</em></a>.</p>
<p>Finally, <tt class="docutils literal"><span class="pre">transmission.py</span></tt> needs to do something when it is executed. This code
illustrates how to use the input and output variables to perform a calculation.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The 5-speed manual transmission is simulated by determining the</span>
<span class="sd">        torque output and engine RPM via the gear ratios.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="n">ratios</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio4</span><span class="p">,</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">ratio5</span><span class="p">]</span>

    <span class="n">gear</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_gear</span>
    <span class="n">differential</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_drive_ratio</span>
    <span class="n">tire_circ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tire_circ</span>
    <span class="n">velocity</span> <span class="o">=</span> <span class="n">convert_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">velocity</span><span class="p">,</span> <span class="s">&#39;mi/h&#39;</span><span class="p">,</span> <span class="s">&#39;inch/min&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">RPM</span> <span class="o">=</span> <span class="p">(</span><span class="n">ratios</span><span class="p">[</span><span class="n">gear</span><span class="p">]</span><span class="o">*</span><span class="n">differential</span><span class="o">*</span><span class="n">velocity</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">tire_circ</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">torque_ratio</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">gear</span><span class="p">]</span><span class="o">*</span><span class="n">differential</span>

    <span class="c"># At low speeds, hold engine speed at 1000 RPM and partially engage the clutch</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPM</span> <span class="o">&lt;</span> <span class="mf">1000.0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_gear</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RPM</span> <span class="o">=</span> <span class="mf">1000.0</span>
</pre></div>
</div>
<p>You may recall that inputs and outputs are attributes of our component, so they are accessed using
<tt class="docutils literal"><span class="pre">self.variablename</span></tt>. It is generally a good idea to create a local copy of a variable for doing calculations in the component for improved efficiency and ease of reading.</p>
<p>We have also imported and used the <tt class="docutils literal"><span class="pre">convert_units</span></tt> function to convert the value of velocity
from units of mi/h to units of inch/min. This makes the units consistent for the calculation
of RPM. The <tt class="docutils literal"><span class="pre">convert_units</span></tt> function provides unit conversion capability for your internal
variables. We could also change the definition of the velocity Float, specifying the units
as <tt class="docutils literal"><span class="pre">'inch/min'=</span></tt>, and then the <tt class="docutils literal"><span class="pre">convert_units</span></tt> call would not be needed.</p>
<p>The transmission model is now complete; the next section will show how to interact with
it in the Python shell. The engine and chassis are created in a similar manner. However, the
engine&#8217;s speed is valid only within a range 1000 to 6000 RPM, primarily because the engine model
is only valid in this range. We addressed this by adding two outputs <tt class="docutils literal"><span class="pre">overspeed</span></tt> and
<tt class="docutils literal"><span class="pre">underspeed</span></tt> to warn when the engine has gone over or under the maximum or minimum RPM.</p>
<p>OpenMDAO&#8217;s variables also include a way to specify a minimum and a maximum value. For example,
the throttle is valid from 0.01 (closed with a small amount of idle flow) to 1.0 (wide
open.)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">throttle</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span>
                 <span class="n">desc</span><span class="o">=</span><span class="s">&#39;Throttle position (from low idle to wide open)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <em>low</em> and <em>high</em> attributes are used to specify a minimum and maximum value
for the throttle. If the throttle is set to a value outside of these limits, an
exception will be raised. OpenMDAO execution is terminated unless this
exception is caught elsewhere and some kind of recovery behavior is defined.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<a href="http://openmdao.org">
 <img src="../../_static/OpenMDAO_Logo_200w_padded.png"
border="0" alt="OpenMDAO Home"/>
</a>

  <h4>Previous topic</h4>
  <p class="topless"><a href="overview.html"
                        title="previous chapter">Problem Overview</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="python_shell.html"
                        title="next chapter">Executing a Component in the Python Shell</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/tutorials/complex/components-variables.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="python_shell.html" title="Executing a Component in the Python Shell"
             >next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="Problem Overview"
             >previous</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../../index.html">OpenMDAO Documentation v0.8.1</a> &raquo;</li>

          <li><a href="../index.html" >OpenMDAO Tutorials</a> &raquo;</li>
          <li><a href="index.html" >A More Complex Tutorial Problem</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright none.
      Last updated on Aug 26, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>